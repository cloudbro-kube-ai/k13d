<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>k13d - kube-ai-dashboard</title>
    <!-- All assets vendored locally for air-gapped environments -->
    <!-- xterm.js for terminal -->
    <link rel="stylesheet" href="vendor/xterm.css" />
    <script src="vendor/xterm.min.js"></script>
    <script src="vendor/xterm-addon-fit.min.js"></script>
    <!-- Chart.js for metrics -->
    <script src="vendor/chart.umd.min.js"></script>
    <!-- ansi_up for log coloring -->
    <script src="vendor/ansi_up.min.js"></script>
    <!-- marked for markdown rendering -->
    <script src="vendor/marked.min.js"></script>
    <!-- G6 for topology graph visualization -->
    <script src="vendor/g6.min.js"></script>
    <!-- CSS Modules -->
    <link rel="stylesheet" href="css/variables.css" />
    <link rel="stylesheet" href="css/base.css" />
    <link rel="stylesheet" href="css/components.css" />
    <link rel="stylesheet" href="css/layout.css" />
    <link rel="stylesheet" href="css/views.css" />
    <link rel="stylesheet" href="css/animations.css" />
</head>
<body>
    <!-- Login Page -->
    <div class="login-container" id="login-page">
        <div class="login-box">
            <!-- Team Branding -->
            <div class="team-branding">
                <span class="team-cloud">‚òÅÔ∏è Cloud Bro</span>
                <span class="team-divider">√ó</span>
                <span class="team-kubeai">KubeAI Team</span>
            </div>

            <!-- ASCII Art Logo -->
            <div class="login-ascii-logo">
 ‚ñà‚ñà‚ïó  ‚ñà‚ñà‚ïó ‚ñà‚ñà‚ïó‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ïó ‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ïó
 ‚ñà‚ñà‚ïë ‚ñà‚ñà‚ïî‚ïù‚ñà‚ñà‚ñà‚ïë‚ïö‚ïê‚ïê‚ïê‚ïê‚ñà‚ñà‚ïó‚ñà‚ñà‚ïî‚ïê‚ïê‚ñà‚ñà‚ïó
 ‚ñà‚ñà‚ñà‚ñà‚ñà‚ïî‚ïù ‚ïö‚ñà‚ñà‚ïë ‚ñà‚ñà‚ñà‚ñà‚ñà‚ïî‚ïù‚ñà‚ñà‚ïë  ‚ñà‚ñà‚ïë
 ‚ñà‚ñà‚ïî‚ïê‚ñà‚ñà‚ïó  ‚ñà‚ñà‚ïë ‚ïö‚ïê‚ïê‚ïê‚ñà‚ñà‚ïó‚ñà‚ñà‚ïë  ‚ñà‚ñà‚ïë
 ‚ñà‚ñà‚ïë  ‚ñà‚ñà‚ïó ‚ñà‚ñà‚ïë‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ïî‚ïù‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ïî‚ïù
 ‚ïö‚ïê‚ïù  ‚ïö‚ïê‚ïù ‚ïö‚ïê‚ïù‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù ‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù</div>
            <h1>k13d</h1>
            <div class="login-subtitle"><span>kube-ai-dashboard</span></div>

            <!-- Auth Mode Indicator -->
            <div id="auth-mode-indicator" class="auth-mode-indicator"></div>

            <div class="login-error" id="login-error"></div>

            <!-- Token Login Form (for token mode) -->
            <div id="token-login-form" class="login-form">
                <div class="token-hint" id="token-hint">
                    <div style="margin-bottom: 12px;">üîê Kubernetes ServiceAccount ÌÜ†ÌÅ∞ÏúºÎ°ú Î°úÍ∑∏Ïù∏ÌïòÏÑ∏Ïöî</div>
                    <div class="token-help-box" id="token-help-box">
                        <div class="token-help-toggle" onclick="toggleTokenHelp()">
                            <span class="token-help-toggle-text">üìã ÌÜ†ÌÅ∞ ÏÉùÏÑ± Î∞©Î≤ï Î≥¥Í∏∞</span>
                            <span class="token-help-toggle-icon">‚ñº</span>
                        </div>
                        <div class="token-help-content">
                            <div class="token-help-step">
                                <span class="step-num">1</span>
                                <div>
                                    <div>ServiceAccount ÏÉùÏÑ± (ÏÑ†ÌÉùÏÇ¨Ìï≠):</div>
                                    <code>kubectl create sa my-user -n default</code>
                                </div>
                            </div>
                            <div class="token-help-step">
                                <span class="step-num">2</span>
                                <div>
                                    <div>Í∂åÌïú Î∂ÄÏó¨:</div>
                                    <code>kubectl create clusterrolebinding my-user-binding \<br/>  --clusterrole=cluster-admin \<br/>  --serviceaccount=default:my-user</code>
                                </div>
                            </div>
                            <div class="token-help-step">
                                <span class="step-num">3</span>
                                <div>
                                    <div>ÌÜ†ÌÅ∞ ÏÉùÏÑ±:</div>
                                    <code>kubectl create token my-user -n default --duration=8760h</code>
                                </div>
                            </div>
                            <div class="token-help-note">
                                üí° <strong>Tip:</strong> ÏúÑ ÌÜ†ÌÅ∞ÏùÑ ÏïÑÎûòÏóê Î∂ôÏó¨ÎÑ£Í≥† EnterÎ•º ÎàÑÎ•¥ÏÑ∏Ïöî!
                            </div>
                        </div>
                    </div>
                </div>
                <textarea id="login-token" class="token-input" placeholder="eyJhbGciOiJSUzI1NiIs..." onkeydown="handleTokenKeydown(event)"></textarea>
                <button class="login-btn" onclick="loginWithToken()">üöÄ Sign In with Token</button>
            </div>

            <!-- Password Login Form (for local mode) -->
            <div id="password-login-form" class="login-form" style="display: none;">
                <div class="local-login-hint">
                    <div style="margin-bottom: 8px;">üë§ Î°úÏª¨ Í≥ÑÏ†ïÏúºÎ°ú Î°úÍ∑∏Ïù∏ÌïòÏÑ∏Ïöî</div>
                    <div style="font-size: 11px; color: var(--text-muted);">Í¥ÄÎ¶¨ÏûêÏóêÍ≤å Í≥ÑÏ†ï Ï†ïÎ≥¥Î•º Î¨∏ÏùòÌïòÏÑ∏Ïöî</div>
                </div>
                <input type="text" id="login-username" placeholder="Username" onkeydown="handlePasswordKeydown(event)">
                <input type="password" id="login-password" placeholder="Password" onkeydown="handlePasswordKeydown(event)">
                <button class="login-btn" onclick="login()">üöÄ Sign In</button>
            </div>

            <!-- Footer with branding -->
            <div class="login-footer">
                <div class="login-k8s-badge">
                    <svg viewBox="0 0 32 32" fill="currentColor">
                        <path d="M16 0C7.2 0 0 7.2 0 16s7.2 16 16 16 16-7.2 16-16S24.8 0 16 0zm0 2c7.7 0 14 6.3 14 14s-6.3 14-14 14S2 23.7 2 16 8.3 2 16 2z"/>
                        <circle cx="16" cy="16" r="4"/>
                        <circle cx="16" cy="6" r="2"/>
                        <circle cx="24.5" cy="11" r="2"/>
                        <circle cx="24.5" cy="21" r="2"/>
                        <circle cx="16" cy="26" r="2"/>
                        <circle cx="7.5" cy="21" r="2"/>
                        <circle cx="7.5" cy="11" r="2"/>
                    </svg>
                    Powered by Kubernetes
                </div>
                <div class="login-version">
                    Made with üíô by <strong>Cloud Bro KubeAI Team</strong>
                </div>
            </div>
        </div>
    </div>

    <!-- Main App -->
    <div class="app-container" id="app">
        <!-- Top Bar -->
        <div class="top-bar">
            <div style="display: flex; align-items: center;">
                <button class="hamburger-btn" id="hamburger-btn" onclick="toggleSidebar()" title="Toggle Sidebar (B)">
                    <span></span>
                    <span></span>
                    <span></span>
                </button>
                <div class="logo">k13d</div>
                <div class="header-team-badge">
                    <span class="header-team-cloud">‚òÅÔ∏è</span>
                    <span class="header-team-text">Cloud Bro √ó KubeAI</span>
                </div>
            </div>
            <div class="search-container">
                <span class="search-icon">üîç</span>
                <input type="text" class="global-search" id="global-search" placeholder="Search all resources..." oninput="handleGlobalSearchInput(event)" onkeydown="handleGlobalSearchKeydown(event)" onfocus="showSearchResults()" autocomplete="off">
                <span class="search-shortcut">‚åòK</span>
                <div class="search-results" id="search-results"></div>
            </div>
            <div class="cluster-switcher" id="cluster-switcher">
                <button class="cluster-switcher-btn" onclick="toggleClusterDropdown()" title="Switch Cluster Context">
                    <span class="cluster-icon">‚éà</span>
                    <span class="cluster-name" id="cluster-name">default</span>
                    <span class="cluster-arrow">‚ñæ</span>
                </button>
                <div class="cluster-dropdown" id="cluster-dropdown">
                    <div class="cluster-dropdown-header">Kubernetes Contexts</div>
                    <div class="cluster-dropdown-list" id="cluster-dropdown-list">
                        <!-- Populated dynamically -->
                    </div>
                </div>
            </div>
            <div class="health-indicator">
                <span class="health-dot ok" id="health-dot"></span>
                <span id="health-status">Connected</span>
            </div>
            <div class="auto-refresh-container">
                <button class="refresh-btn" onclick="manualRefresh()" title="Refresh now">
                    <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M23 4v6h-6M1 20v-6h6"/>
                        <path d="M3.51 9a9 9 0 0 1 14.85-3.36L23 10M1 14l4.64 4.36A9 9 0 0 0 20.49 15"/>
                    </svg>
                </button>
                <span style="color: var(--text-secondary);">Auto:</span>
                <div class="auto-refresh-toggle" id="auto-refresh-toggle" onclick="toggleAutoRefresh()" title="Toggle auto-refresh"></div>
                <select class="refresh-interval-select" id="refresh-interval" onchange="setAutoRefreshInterval(this.value)" title="Refresh interval">
                    <option value="10">10s</option>
                    <option value="30" selected>30s</option>
                    <option value="60">1m</option>
                    <option value="120">2m</option>
                    <option value="300">5m</option>
                </select>
                <span class="last-refresh-time" id="last-refresh-time">--:--:--</span>
            </div>
            <div class="user-info">
                <span class="user-badge" id="user-badge">admin</span>
                <button class="logout-btn" onclick="showShortcuts()">?</button>
                <button class="logout-btn" onclick="showSettings()">Settings</button>
                <button class="logout-btn" id="logout-btn" onclick="logout()">Logout</button>
            </div>
        </div>

        <!-- Sidebar Overlay (mobile backdrop) -->
        <div class="sidebar-overlay" id="sidebar-overlay" onclick="toggleSidebar()"></div>

        <!-- Main Content -->
        <div class="main-container">
            <!-- Sidebar -->
            <div class="sidebar sidebar-transition" id="sidebar">
                <!-- Mobile header with close button -->
                <div class="sidebar-mobile-header">
                    <span class="sidebar-mobile-title">Navigation</span>
                    <button class="sidebar-close-btn" onclick="toggleSidebar()" title="Close">&times;</button>
                </div>
                <div class="nav-section">
                    <div class="nav-item" data-resource="overview" onclick="showOverviewPanel()" style="font-weight: 600; margin-bottom: 8px;">
                        <span>Overview</span>
                    </div>
                </div>
                <div class="nav-section">
                    <div class="nav-title" onclick="toggleNavSection(this)">Workloads<span class="nav-section-arrow">‚ñæ</span></div>
                    <div class="nav-item active" data-resource="pods" onclick="switchResource('pods')">
                        <span>Pods</span>
                        <span class="count" id="pods-count">0</span>
                    </div>
                    <div class="nav-item" data-resource="deployments" onclick="switchResource('deployments')">
                        <span>Deployments</span>
                        <span class="count" id="deployments-count">0</span>
                    </div>
                    <div class="nav-item" data-resource="daemonsets" onclick="switchResource('daemonsets')">
                        <span>DaemonSets</span>
                        <span class="count" id="daemonsets-count">0</span>
                    </div>
                    <div class="nav-item" data-resource="statefulsets" onclick="switchResource('statefulsets')">
                        <span>StatefulSets</span>
                        <span class="count" id="statefulsets-count">0</span>
                    </div>
                    <div class="nav-item" data-resource="replicasets" onclick="switchResource('replicasets')">
                        <span>ReplicaSets</span>
                        <span class="count" id="replicasets-count">0</span>
                    </div>
                    <div class="nav-item" data-resource="jobs" onclick="switchResource('jobs')">
                        <span>Jobs</span>
                        <span class="count" id="jobs-count">0</span>
                    </div>
                    <div class="nav-item" data-resource="cronjobs" onclick="switchResource('cronjobs')">
                        <span>CronJobs</span>
                        <span class="count" id="cronjobs-count">0</span>
                    </div>
                </div>

                <div class="nav-section">
                    <div class="nav-title" onclick="toggleNavSection(this)">Network<span class="nav-section-arrow">‚ñæ</span></div>
                    <div class="nav-item" data-resource="services" onclick="switchResource('services')">
                        <span>Services</span>
                        <span class="count" id="services-count">0</span>
                    </div>
                    <div class="nav-item" data-resource="ingresses" onclick="switchResource('ingresses')">
                        <span>Ingresses</span>
                        <span class="count" id="ingresses-count">0</span>
                    </div>
                    <div class="nav-item" data-resource="networkpolicies" onclick="switchResource('networkpolicies')">
                        <span>NetworkPolicies</span>
                        <span class="count" id="networkpolicies-count">0</span>
                    </div>
                </div>

                <div class="nav-section">
                    <div class="nav-title" onclick="toggleNavSection(this)">Config<span class="nav-section-arrow">‚ñæ</span></div>
                    <div class="nav-item" data-resource="configmaps" onclick="switchResource('configmaps')">
                        <span>ConfigMaps</span>
                        <span class="count" id="configmaps-count">0</span>
                    </div>
                    <div class="nav-item" data-resource="secrets" onclick="switchResource('secrets')">
                        <span>Secrets</span>
                        <span class="count" id="secrets-count">0</span>
                    </div>
                    <div class="nav-item" data-resource="serviceaccounts" onclick="switchResource('serviceaccounts')">
                        <span>ServiceAccounts</span>
                        <span class="count" id="serviceaccounts-count">0</span>
                    </div>
                </div>

                <div class="nav-section">
                    <div class="nav-title" onclick="toggleNavSection(this)">Storage<span class="nav-section-arrow">‚ñæ</span></div>
                    <div class="nav-item" data-resource="persistentvolumes" onclick="switchResource('persistentvolumes')">
                        <span>PersistentVolumes</span>
                        <span class="count" id="persistentvolumes-count">0</span>
                    </div>
                    <div class="nav-item" data-resource="persistentvolumeclaims" onclick="switchResource('persistentvolumeclaims')">
                        <span>PVCs</span>
                        <span class="count" id="persistentvolumeclaims-count">0</span>
                    </div>
                </div>

                <div class="nav-section">
                    <div class="nav-title" onclick="toggleNavSection(this)">Cluster<span class="nav-section-arrow">‚ñæ</span></div>
                    <div class="nav-item" data-resource="nodes" onclick="switchResource('nodes')">
                        <span>Nodes</span>
                        <span class="count" id="nodes-count">0</span>
                    </div>
                    <div class="nav-item" data-resource="namespaces" onclick="switchResource('namespaces')">
                        <span>Namespaces</span>
                        <span class="count" id="namespaces-count">0</span>
                    </div>
                    <div class="nav-item" data-resource="events" onclick="switchResource('events')">
                        <span>Events</span>
                        <span class="count" id="events-count">0</span>
                    </div>
                </div>

                <div class="nav-section">
                    <div class="nav-title" onclick="toggleNavSection(this)">RBAC<span class="nav-section-arrow">‚ñæ</span></div>
                    <div class="nav-item" data-resource="roles" onclick="switchResource('roles')">
                        <span>Roles</span>
                        <span class="count" id="roles-count">0</span>
                    </div>
                    <div class="nav-item" data-resource="rolebindings" onclick="switchResource('rolebindings')">
                        <span>RoleBindings</span>
                        <span class="count" id="rolebindings-count">0</span>
                    </div>
                    <div class="nav-item" data-resource="clusterroles" onclick="switchResource('clusterroles')">
                        <span>ClusterRoles</span>
                        <span class="count" id="clusterroles-count">0</span>
                    </div>
                    <div class="nav-item" data-resource="clusterrolebindings" onclick="switchResource('clusterrolebindings')">
                        <span>ClusterRoleBindings</span>
                        <span class="count" id="clusterrolebindings-count">0</span>
                    </div>
                </div>

                <div class="nav-section" id="crd-nav-section">
                    <div class="nav-title" style="display: flex; justify-content: space-between; align-items: center;" onclick="toggleNavSection(this)">
                        Custom Resources
                        <span class="count" id="crd-count" style="font-size: 10px;">0</span>
                        <span class="nav-section-arrow">‚ñæ</span>
                    </div>
                    <div id="crd-nav-items">
                        <!-- CRD items will be dynamically loaded here -->
                    </div>
                </div>

                <div class="nav-section">
                    <div class="nav-title" onclick="toggleNavSection(this)">Visualization<span class="nav-section-arrow">‚ñæ</span></div>
                    <div class="nav-item" data-resource="topology" onclick="showTopology()">
                        <span>Topology</span>
                    </div>
                    <div class="nav-item" data-resource="applications" onclick="showApplicationsView()">
                        <span>Applications</span>
                    </div>
                    <div class="nav-item" data-resource="rbac-viz" onclick="showRBACVizView()">
                        <span>RBAC Viewer</span>
                    </div>
                    <div class="nav-item" data-resource="netpol-viz" onclick="showNetPolVizView()">
                        <span>Net Policy Map</span>
                    </div>
                    <div class="nav-item" data-resource="timeline" onclick="showTimelineView()">
                        <span>Event Timeline</span>
                    </div>
                </div>

                <div class="nav-section">
                    <div class="nav-title" onclick="toggleNavSection(this)">Operations<span class="nav-section-arrow">‚ñæ</span></div>
                    <div class="nav-item" data-resource="validate" onclick="showValidateView()">
                        <span>Validate</span>
                    </div>
<div class="nav-item" data-resource="templates" onclick="showTemplatesView()">
                        <span>Templates</span>
                    </div>
                </div>

                <div class="nav-section">
                    <div class="nav-title" onclick="toggleNavSection(this)">Monitoring<span class="nav-section-arrow">‚ñæ</span></div>
                    <div class="nav-item" data-resource="metrics" onclick="showMetricsDashboard()">
                        <span>Metrics</span>
                    </div>
                    <div class="nav-item" onclick="showAuditLogs()">
                        <span>Audit Logs</span>
                    </div>
                    <div class="nav-item" onclick="showReports()">
                        <span>Reports</span>
                    </div>
                </div>
            </div>

            <!-- Content Wrapper -->
            <div class="content-wrapper">
                <!-- Main Panel -->
                <div class="main-panel" id="main-panel">
                    <div class="panel-header">
                        <h2 class="panel-title" id="panel-title">Pods</h2>
                        <span class="resource-summary" id="resource-summary"></span>
                        <div class="panel-actions">
                            <select class="namespace-select" id="namespace-select" onchange="onNamespaceChange()">
                                <option value="">All Namespaces</option>
                            </select>
                            <button class="refresh-btn" onclick="refreshData()">‚Üª Refresh</button>
                            <button class="ai-toggle-btn" id="ai-toggle-btn" onclick="toggleAIPanel()" title="Toggle AI Assistant (Ctrl+A)">AI</button>
                        </div>
                    </div>
                    <div class="filter-bar">
                        <span style="font-size: 12px; color: var(--text-secondary);">Filter:</span>
                        <input type="text" class="filter-input" id="filter-input" placeholder="Type to filter..." onkeyup="handleFilter(event)">
                        <button class="filter-toggle-btn" id="column-filter-toggle" onclick="toggleColumnFilters()" title="Toggle column filters (Ctrl+F)">
                            <span>‚äû</span> Columns
                        </button>
                        <div id="filter-chips"></div>
                        <div class="active-filters" id="active-column-filters"></div>
                        <span style="font-size: 11px; color: var(--text-secondary); margin-left: auto;">/ filter | Ctrl+F columns</span>
                    </div>
                    <div class="table-container">
                        <table>
                            <thead id="table-header"></thead>
                            <tbody id="table-body"></tbody>
                        </table>
                    </div>
                    <!-- Pagination -->
                    <div class="pagination-container" id="pagination-container">
                        <div class="pagination-info" id="pagination-info">
                            Showing 0 items
                        </div>
                        <div class="pagination-controls">
                            <select class="page-size-select" id="page-size-select" onchange="onPageSizeChange()">
                                <option value="25">25 / page</option>
                                <option value="50" selected>50 / page</option>
                                <option value="100">100 / page</option>
                                <option value="200">200 / page</option>
                                <option value="-1">All</option>
                            </select>
                            <button class="pagination-btn" id="prev-page-btn" onclick="goToPrevPage()" disabled>‚Üê Prev</button>
                            <span id="page-indicator">1 / 1</span>
                            <button class="pagination-btn" id="next-page-btn" onclick="goToNextPage()" disabled>Next ‚Üí</button>
                        </div>
                    </div>
                </div>

                <!-- Topology View Container -->
                <div id="topology-container">
                    <div id="topology-toolbar">
                        <select id="topology-ns-select" onchange="onTopologyNamespaceChange()">
                            <option value="">All Namespaces</option>
                        </select>
                        <select id="topology-kind-filter" onchange="loadTopology()">
                            <option value="">All Kinds</option>
                            <option value="Deployment">Deployments</option>
                            <option value="StatefulSet">StatefulSets</option>
                            <option value="DaemonSet">DaemonSets</option>
                            <option value="Pod">Pods</option>
                            <option value="Service">Services</option>
                            <option value="Ingress">Ingresses</option>
                            <option value="Job">Jobs</option>
                            <option value="CronJob">CronJobs</option>
                            <option value="ConfigMap">ConfigMaps</option>
                            <option value="Secret">Secrets</option>
                            <option value="PVC">PVCs</option>
                            <option value="HPA">HPAs</option>
                        </select>
                        <input type="text" id="topology-search" placeholder="Search resources..." oninput="filterTopologyGraph(this.value)">
                        <div class="toolbar-separator"></div>
                        <button onclick="topologyFitView()">Fit</button>
                        <button onclick="clearTopologyFocus()">Show All</button>
                        <button onclick="loadTopology()">‚Üª Refresh</button>
                        <div class="toolbar-separator"></div>
                        <button onclick="showTopologyTreeView()" title="View resource ownership as a tree">Tree View</button>
                        <div class="toolbar-separator"></div>
                        <label><input type="checkbox" id="topology-show-configmaps" onchange="loadTopology()"> ConfigMaps</label>
                        <label><input type="checkbox" id="topology-show-secrets" onchange="loadTopology()"> Secrets</label>
                        <div class="topology-legend">
                            <div class="topology-legend-item"><div class="topology-legend-dot" style="background: var(--accent-green);"></div> Running</div>
                            <div class="topology-legend-item"><div class="topology-legend-dot" style="background: var(--accent-yellow);"></div> Pending</div>
                            <div class="topology-legend-item"><div class="topology-legend-dot" style="background: var(--accent-red);"></div> Failed</div>
                            <div class="topology-legend-item"><div class="topology-legend-dot" style="background: var(--accent-blue);"></div> Succeeded</div>
                        </div>
                    </div>
                    <div id="topology-graph"></div>
                    <div id="topology-detail">
                        <div class="topology-detail-header">
                            <h3 id="topology-detail-title">Resource</h3>
                            <button class="topology-detail-close" onclick="closeTopologyDetail()">&times;</button>
                        </div>
                        <div class="topology-detail-body" id="topology-detail-body"></div>
                        <div class="topology-detail-actions">
                            <button id="topology-view-dashboard-btn" onclick="topologyNavigateToDashboard()">View in Dashboard</button>
                        </div>
                    </div>
                </div>

                <!-- Overview Container -->
                <div class="custom-view-container" id="overview-container" style="display:none;">
                    <div class="custom-view-toolbar">
                        <h2>Cluster Overview</h2>
                        <div style="display:flex;gap:8px;align-items:center;">
                            <span class="overview-context" id="overview-context" style="color:var(--text-secondary);font-size:12px;"></span>
                            <button onclick="loadOverviewData()" style="padding:6px 12px;border-radius:6px;border:1px solid var(--border-color);background:var(--bg-secondary);color:var(--text-primary);cursor:pointer;">Refresh</button>
                        </div>
                    </div>
                    <div class="custom-view-body" id="overview-body">
                        <div class="overview-cards" id="overview-cards">
                            <div class="overview-card">
                                <div class="overview-card-icon" style="background: var(--accent-green);">N</div>
                                <div class="overview-card-content">
                                    <div class="overview-card-value" id="ov-nodes-ready">-/-</div>
                                    <div class="overview-card-label">Nodes Ready</div>
                                </div>
                            </div>
                            <div class="overview-card">
                                <div class="overview-card-icon" style="background: var(--accent-blue);">P</div>
                                <div class="overview-card-content">
                                    <div class="overview-card-value" id="ov-pods-running">-/-</div>
                                    <div class="overview-card-label">Pods Running</div>
                                </div>
                            </div>
                            <div class="overview-card">
                                <div class="overview-card-icon" style="background: var(--accent-purple);">D</div>
                                <div class="overview-card-content">
                                    <div class="overview-card-value" id="ov-deploy-healthy">-/-</div>
                                    <div class="overview-card-label">Deployments Healthy</div>
                                </div>
                            </div>
                            <div class="overview-card">
                                <div class="overview-card-icon" style="background: var(--accent-cyan);">NS</div>
                                <div class="overview-card-content">
                                    <div class="overview-card-value" id="ov-namespaces">-</div>
                                    <div class="overview-card-label">Namespaces</div>
                                </div>
                            </div>
                        </div>
                        <div class="overview-sections">
                            <div class="overview-section">
                                <h3>Quick Actions</h3>
                                <div class="overview-actions">
                                    <button class="overview-action-btn" onclick="switchResource('pods')">Pods</button>
                                    <button class="overview-action-btn" onclick="switchResource('deployments')">Deployments</button>
                                    <button class="overview-action-btn" onclick="switchResource('services')">Services</button>
                                    <button class="overview-action-btn" onclick="switchResource('nodes')">Nodes</button>
                                    <button class="overview-action-btn" onclick="showTopology()">Topology</button>
                                    <button class="overview-action-btn" onclick="showMetricsDashboard()">Metrics</button>
                                    <button class="overview-action-btn" onclick="showApplicationsView()">Applications</button>
                                    <button class="overview-action-btn" onclick="showValidateView()">Validate</button>
                                </div>
                            </div>
                            <div class="overview-section">
                                <h3>Recent Events</h3>
                                <div class="overview-events" id="overview-events">
                                    <p style="color:var(--text-secondary);">Loading events...</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Metrics Dashboard Container -->
                <div class="custom-view-container" id="metrics-dashboard-container" style="display:none;">
                    <div class="custom-view-toolbar">
                        <h2>Cluster Metrics</h2>
                        <div style="display:flex;gap:8px;align-items:center;">
                            <select id="metrics-dash-ns-select" onchange="loadMetricsDashData()">
                                <option value="">All Namespaces</option>
                            </select>
                            <button onclick="loadMetricsDashData()">‚Üª Refresh</button>
                            <div class="toolbar-separator"></div>
                            <button onclick="showMetrics()" title="View historical metrics charts">Charts</button>
                        </div>
                    </div>
                    <div class="custom-view-body" id="metrics-dash-body">
                        <div class="loading-placeholder">Loading metrics...</div>
                    </div>
                </div>

                <!-- Topology Tree View Container -->
                <div class="custom-view-container" id="topology-tree-container" style="display:none;">
                    <div class="custom-view-toolbar">
                        <h2>Topology Tree</h2>
                        <div style="display:flex;gap:8px;align-items:center;">
                            <select id="topo-tree-type-select" onchange="loadTopologyTreeData()">
                                <option value="deploy">Deployments</option>
                                <option value="sts">StatefulSets</option>
                                <option value="ds">DaemonSets</option>
                                <option value="job">Jobs</option>
                                <option value="cj">CronJobs</option>
                            </select>
                            <select id="topo-tree-ns-select" onchange="loadTopologyTreeData()">
                                <option value="">All Namespaces</option>
                            </select>
                            <button onclick="loadTopologyTreeData()">‚Üª Refresh</button>
                            <div class="toolbar-separator"></div>
                            <button onclick="showTopology()" title="View resource relationships as a graph">Graph View</button>
                        </div>
                    </div>
                    <div class="custom-view-body" id="topo-tree-body">
                        <div class="loading-placeholder">Loading topology tree...</div>
                    </div>
                </div>

                <!-- Applications View Container -->
                <div class="custom-view-container" id="applications-container" style="display:none;">
                    <div class="custom-view-toolbar">
                        <h2>Applications</h2>
                        <div style="display:flex;gap:8px;align-items:center;">
                            <select id="apps-ns-select" onchange="loadApplicationsData()">
                                <option value="">All Namespaces</option>
                            </select>
                            <button onclick="loadApplicationsData()">‚Üª Refresh</button>
                        </div>
                    </div>
                    <div class="custom-view-body" id="applications-body">
                        <div class="loading-placeholder">Loading applications...</div>
                    </div>
                </div>

                <!-- Validate View Container -->
                <div class="custom-view-container" id="validate-container" style="display:none;">
                    <div class="custom-view-toolbar">
                        <h2>Cluster Validation</h2>
                        <div style="display:flex;gap:8px;align-items:center;">
                            <select id="validate-ns-select" onchange="loadValidateData()">
                                <option value="">Select Namespace</option>
                            </select>
                            <button onclick="loadValidateData()">‚Üª Run Validation</button>
                        </div>
                    </div>
                    <div class="custom-view-body" id="validate-body">
                        <div class="loading-placeholder">Select a namespace and run validation...</div>
                    </div>
                </div>


                <!-- RBAC Visualization Container -->
                <div class="custom-view-container" id="rbac-viz-container" style="display:none;">
                    <div class="custom-view-toolbar">
                        <h2>RBAC Viewer</h2>
                        <div style="display:flex;gap:8px;align-items:center;">
                            <select id="rbac-viz-ns-select" onchange="loadRBACVizData()">
                                <option value="">Cluster-wide</option>
                            </select>
                            <select id="rbac-viz-filter" onchange="loadRBACVizData()">
                                <option value="">All Subjects</option>
                                <option value="ServiceAccount">ServiceAccounts</option>
                                <option value="User">Users</option>
                                <option value="Group">Groups</option>
                            </select>
                            <button onclick="loadRBACVizData()">‚Üª Refresh</button>
                        </div>
                    </div>
                    <div class="custom-view-body" id="rbac-viz-body">
                        <div class="loading-placeholder">Loading RBAC data...</div>
                    </div>
                </div>

                <!-- Network Policy Visualization Container -->
                <div class="custom-view-container" id="netpol-viz-container" style="display:none;">
                    <div class="custom-view-toolbar">
                        <h2>Network Policy Map</h2>
                        <div style="display:flex;gap:8px;align-items:center;">
                            <select id="netpol-viz-ns-select" onchange="loadNetPolVizData()">
                                <option value="">All Namespaces</option>
                            </select>
                            <button onclick="loadNetPolVizData()">‚Üª Refresh</button>
                        </div>
                    </div>
                    <div class="custom-view-body" id="netpol-viz-body">
                        <div class="loading-placeholder">Loading Network Policies...</div>
                    </div>
                </div>

                <!-- Event Timeline Container -->
                <div class="custom-view-container" id="timeline-container" style="display:none;">
                    <div class="custom-view-toolbar">
                        <h2>Event Timeline</h2>
                        <div style="display:flex;gap:8px;align-items:center;">
                            <select id="timeline-ns-select" onchange="loadTimelineData()">
                                <option value="">All Namespaces</option>
                            </select>
                            <select id="timeline-hours" onchange="loadTimelineData()">
                                <option value="1">Last 1 hour</option>
                                <option value="6">Last 6 hours</option>
                                <option value="24" selected>Last 24 hours</option>
                                <option value="72">Last 3 days</option>
                            </select>
                            <label style="display:flex;align-items:center;gap:4px;font-size:12px;color:var(--text-secondary);"><input type="checkbox" id="timeline-warnings-only" onchange="loadTimelineData()"> Warnings only</label>
                            <button onclick="loadTimelineData()">‚Üª Refresh</button>
                        </div>
                    </div>
                    <div class="custom-view-body" id="timeline-body">
                        <div class="loading-placeholder">Loading events...</div>
                    </div>
                </div>


                <!-- Templates Container -->
                <div class="custom-view-container" id="templates-container" style="display:none;">
                    <div class="custom-view-toolbar">
                        <h2>Resource Templates</h2>
                        <div style="display:flex;gap:8px;align-items:center;">
                            <select id="templates-category" onchange="filterTemplates()">
                                <option value="">All Categories</option>
                                <option value="webserver">Web Server</option>
                                <option value="database">Database</option>
                                <option value="cache">Cache</option>
                                <option value="queue">Message Queue</option>
                                <option value="monitoring">Monitoring</option>
                                <option value="batch">Batch Jobs</option>
                                <option value="networking">Networking</option>
                            </select>
                        </div>
                    </div>
                    <div class="custom-view-body" id="templates-body">
                        <div class="loading-placeholder">Loading templates...</div>
                    </div>
                </div>


                <!-- Resize Handle -->
                <div class="resize-handle" id="resize-handle"></div>

                <!-- AI Panel -->
                <div class="ai-panel" id="ai-panel">
                    <!-- Chat History Sidebar -->
                    <div class="chat-history-sidebar" id="chat-history-sidebar">
                        <div class="chat-history-header">
                            <h4>üí¨ Chat History</h4>
                            <div class="chat-history-actions">
                                <button class="chat-history-btn primary" onclick="createNewChat()" title="New Chat">+</button>
                                <button class="chat-history-btn" onclick="toggleChatHistory()" title="Close">‚úï</button>
                            </div>
                        </div>
                        <div class="chat-history-search">
                            <input type="text" id="chat-history-search" placeholder="Search chats..." oninput="filterChatHistory(this.value)">
                        </div>
                        <div class="chat-history-list" id="chat-history-list">
                            <!-- Populated dynamically -->
                        </div>
                    </div>

                    <div class="ai-header">
                        <button class="chat-history-toggle" id="chat-history-toggle" onclick="toggleChatHistory()" title="Chat History">üìã</button>
                        <span>AI Assistant</span>
                        <span class="ai-status-dot" id="ai-status-dot" title="Checking connection...">‚óè</span>
                        <span class="ai-badge" id="ai-model-badge">Loading...</span>
                        <button class="debug-toggle" id="debug-toggle" onclick="toggleDebugMode()" style="margin-left: auto;" title="Toggle Debug Mode">üêõ Debug</button>
                    </div>
                    <!-- Guardrails Status -->
                    <div class="guardrails-status" id="guardrails-status">
                        <div class="guardrails-indicator safe" id="guardrails-indicator">
                            <span class="dot"></span>
                            <span>Safe Mode</span>
                        </div>
                        <span class="guardrails-limit" id="guardrails-limit">Requests: 0/50</span>
                    </div>
                    <!-- Context chips for selected resources -->
                    <div class="context-chips" id="context-chips">
                        <span style="font-size: 11px; color: var(--text-secondary);">Context: Click resources to add</span>
                    </div>
                    <div class="ai-messages" id="ai-messages">
                        <div class="message assistant">
                            <div class="message-content">
                                Welcome to k13d! I can help you manage your Kubernetes cluster.
                                <br><br>
                                Try asking:
                                <br>- "Show me all pods"
                                <br>- "Create an nginx pod"
                                <br>- "Scale deployment to 3 replicas"
                                <br><br>
                                <strong>Tip:</strong> Click any resource row to add it as context for AI analysis!
                            </div>
                        </div>
                    </div>
                    <!-- Debug panel for MCP Tool Calling -->
                    <div class="debug-panel" id="debug-panel">
                        <div class="debug-header">
                            <span>üîß MCP Tool Calling Debug</span>
                            <button class="debug-toggle" onclick="clearDebugLogs()">Clear</button>
                        </div>
                        <div class="debug-content" id="debug-content">
                            <div style="color: var(--text-secondary); text-align: center; padding: 20px;">
                                Debug mode active. Tool calls will appear here.
                            </div>
                        </div>
                    </div>
                    <div class="ai-input-container" id="ai-input-container">
                        <textarea class="ai-input" id="ai-input" placeholder="Ask me anything about Kubernetes..." rows="2"></textarea>
                        <div class="ai-actions">
                            <span class="ai-hint">Enter send ¬∑ Shift+Enter newline ¬∑ ‚Üë‚Üì history</span>
                            <div class="ai-actions-buttons">
                                <button class="ai-clear-btn" id="ai-clear-btn" onclick="clearAiInput()" title="Clear input">&#x2715;</button>
                                <button class="ai-expand-btn" id="ai-expand-btn" onclick="toggleAiExpand()" title="Expand input area">&#x26F6;</button>
                                <button class="send-btn" id="send-btn" onclick="sendMessage()">Send</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Settings Modal -->
    <div class="modal-overlay" id="settings-modal">
        <div class="modal">
            <div class="modal-header">
                <h2>Settings</h2>
                <button class="modal-close" onclick="closeSettings()">&times;</button>
            </div>
            <div class="modal-body">
                <div class="tabs">
                    <div class="tab active" onclick="switchSettingsTab('general')">General</div>
                    <div class="tab" onclick="switchSettingsTab('ai')">AI</div>
                    <div class="tab" onclick="switchSettingsTab('mcp')">MCP</div>
                    <div class="tab" onclick="switchSettingsTab('security')">Security</div>
                    <div class="tab" onclick="switchSettingsTab('metrics')">Metrics</div>
                    <div class="tab" onclick="switchSettingsTab('notifications')">Notifications</div>
                    <div class="tab" id="admin-tab" onclick="switchSettingsTab('admin')" style="display:none;">Admin</div>
                    <div class="tab" onclick="switchSettingsTab('about')">About</div>
                </div>

                <div id="settings-general" class="settings-content">
                    <div class="settings-section">
                        <h4>Display</h4>
                        <div class="settings-row">
                            <div>
                                <div class="settings-label">Language</div>
                            </div>
                            <select id="setting-language">
                                <option value="en">English</option>
                                <option value="ko">ÌïúÍµ≠Ïñ¥ (Korean)</option>
                                <option value="zh">‰∏≠Êñá (Chinese)</option>
                                <option value="ja">Êó•Êú¨Ë™û (Japanese)</option>
                            </select>
                        </div>
                        <div class="settings-row">
                            <div>
                                <div class="settings-label">Log Level</div>
                            </div>
                            <select id="setting-log-level">
                                <option value="debug">Debug</option>
                                <option value="info">Info</option>
                                <option value="warn">Warning</option>
                                <option value="error">Error</option>
                            </select>
                        </div>
                        <div class="settings-row">
                            <div>
                                <div class="settings-label">Timezone</div>
                                <div class="settings-description">Set the timezone for displaying dates and times</div>
                            </div>
                            <select id="setting-timezone">
                                <option value="auto">Auto (Browser)</option>
                                <option value="UTC">UTC</option>
                                <option value="Asia/Seoul">Asia/Seoul (KST)</option>
                                <option value="Asia/Tokyo">Asia/Tokyo (JST)</option>
                                <option value="Asia/Shanghai">Asia/Shanghai (CST)</option>
                                <option value="America/New_York">America/New_York (EST)</option>
                                <option value="America/Chicago">America/Chicago (CST)</option>
                                <option value="America/Los_Angeles">America/Los_Angeles (PST)</option>
                                <option value="Europe/London">Europe/London (GMT)</option>
                                <option value="Europe/Berlin">Europe/Berlin (CET)</option>
                                <option value="Europe/Paris">Europe/Paris (CET)</option>
                                <option value="Australia/Sydney">Australia/Sydney (AEST)</option>
                            </select>
                        </div>
                    </div>
                    <div class="settings-section">
                        <h4>AI Chat</h4>
                        <div class="settings-row">
                            <div>
                                <div class="settings-label">Enable Streaming</div>
                                <div class="settings-description">Show AI responses as they're generated</div>
                            </div>
                            <div class="auto-refresh-toggle" id="setting-streaming" onclick="toggleStreamingSetting()"></div>
                        </div>
                    </div>
                    <div class="settings-section">
                        <h4>Auto Refresh</h4>
                        <div class="settings-row">
                            <div>
                                <div class="settings-label">Enable Auto Refresh</div>
                                <div class="settings-description">Automatically refresh resource data</div>
                            </div>
                            <div class="auto-refresh-toggle" id="setting-auto-refresh" onclick="toggleAutoRefreshSetting()"></div>
                        </div>
                        <div class="settings-row">
                            <div>
                                <div class="settings-label">Refresh Interval</div>
                                <div class="settings-description">How often to refresh data</div>
                            </div>
                            <select id="setting-refresh-interval" onchange="setAutoRefreshIntervalSetting(this.value)">
                                <option value="10">10 seconds</option>
                                <option value="30">30 seconds</option>
                                <option value="60">1 minute</option>
                                <option value="120">2 minutes</option>
                                <option value="300">5 minutes</option>
                            </select>
                        </div>
                    </div>
                    <div class="settings-section">
                        <h4>Theme / Skin</h4>
                        <div class="settings-row">
                            <div>
                                <div class="settings-label">Color Theme</div>
                                <div class="settings-description">Change the dashboard color scheme</div>
                            </div>
                            <select id="setting-theme" onchange="applyTheme(this.value)">
                                <option value="light">Light (Default)</option>
                                <option value="tokyo-night">Tokyo Night</option>
                                <option value="production">Production (Red)</option>
                                <option value="staging">Staging (Yellow)</option>
                                <option value="dev">Development (Green)</option>
                            </select>
                        </div>
                    </div>
                </div>

                <!-- AI Tab (merged Models + LLM) -->
                <div id="settings-ai" class="settings-content" style="display:none;">
                    <!-- LLM Connection Status -->
                    <div class="settings-section" style="margin-bottom:16px;">
                        <div style="display:flex;align-items:center;justify-content:space-between;padding:12px;background:var(--bg-primary);border-radius:8px;">
                            <div style="display:flex;align-items:center;gap:12px;">
                                <div id="llm-status-indicator" style="width:16px;height:16px;border-radius:50%;background:#888;box-shadow:0 0 8px rgba(136,136,136,0.5);transition:all 0.3s;"></div>
                                <div>
                                    <div id="llm-status-text" style="font-weight:500;">Connection Status: Unknown</div>
                                    <div id="llm-status-detail" style="font-size:12px;color:var(--text-secondary);">Click 'Test Connection' to verify</div>
                                </div>
                            </div>
                            <button class="btn btn-secondary" id="llm-test-btn" onclick="testLLMConnection()" style="min-width:130px;">
                                <span id="llm-test-btn-text">Test Connection</span>
                            </button>
                        </div>
                    </div>

                    <!-- Current LLM Configuration -->
                    <div class="settings-section">
                        <h4>LLM Configuration</h4>
                        <div class="form-group">
                            <label>Provider</label>
                            <select id="setting-llm-provider" onchange="updateEndpointPlaceholder()">
                                <option value="upstage">Upstage Solar</option>
                                <option value="openai">OpenAI</option>
                                <option value="ollama">Ollama</option>
                                <option value="gemini">Google Gemini</option>
                                <option value="anthropic">Anthropic Claude</option>
                                <option value="bedrock">AWS Bedrock</option>
                                <option value="azopenai">Azure OpenAI</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>Model <button type="button" id="fetch-models-btn" onclick="fetchAvailableModels()" style="font-size:11px;color:var(--accent-blue);background:none;border:1px solid var(--accent-blue);border-radius:4px;padding:1px 8px;margin-left:8px;cursor:pointer;display:none;">Fetch Models</button><span id="fetch-models-status" style="font-size:11px;color:var(--text-secondary);margin-left:6px;"></span></label>
                            <input type="text" id="setting-llm-model" placeholder="solar-pro2" list="model-suggestions">
                            <datalist id="model-suggestions"></datalist>
                        </div>
                        <div class="form-group">
                            <label>Endpoint <span id="endpoint-hint" style="font-size:11px;color:var(--text-secondary);"></span></label>
                            <input type="text" id="setting-llm-endpoint" placeholder="https://api.upstage.ai/v1">
                        </div>
                        <div class="form-group">
                            <label>API Key <a href="https://console.upstage.ai/api-keys" target="_blank" style="font-size:11px;color:var(--accent-blue);margin-left:8px;">Get API Key ‚Üí</a></label>
                            <input type="password" id="setting-llm-apikey" placeholder="up_...">
                        </div>
                    </div>

                    <!-- Reasoning Effort (Solar Pro2) -->
                    <div class="settings-section" id="reasoning-effort-section" style="margin-top:16px;padding:12px;background:var(--bg-primary);border-radius:8px;">
                        <div style="display:flex;align-items:center;gap:12px;margin-bottom:8px;">
                            <span style="font-size:20px;">üß†</span>
                            <div>
                                <h4 style="margin:0;color:var(--accent-purple);">Reasoning Effort (Solar Pro2)</h4>
                                <p style="font-size:12px;color:var(--text-secondary);margin:4px 0 0 0;">Control reasoning depth for complex tasks</p>
                            </div>
                        </div>
                        <div class="settings-row">
                            <div>
                                <div class="settings-label">Enable High Reasoning</div>
                                <div class="settings-description">Use deeper reasoning for complex tasks (may increase token usage)</div>
                            </div>
                            <div class="auto-refresh-toggle" id="reasoning-effort-toggle" onclick="toggleReasoningEffort()"></div>
                        </div>
                        <div style="margin-top:8px;font-size:12px;color:var(--text-secondary);">
                            <span id="reasoning-effort-status">Current: minimal (default)</span>
                        </div>
                    </div>

                    <!-- Model Profiles -->
                    <div class="settings-section" style="margin-top:20px;">
                        <h4>Saved Model Profiles</h4>
                        <p class="settings-description" style="margin-bottom:12px;">Manage multiple LLM configurations and switch between them easily.</p>

                        <div id="models-list" style="margin-bottom:16px;">
                            <!-- Populated by JavaScript -->
                        </div>

                        <button class="btn-add" onclick="showAddModelForm()" style="margin-top:8px;"><span class="plus-icon">+</span> Add Model Profile</button>
                    </div>

                    <div id="add-model-form" class="settings-section" style="display:none;margin-top:16px;background:var(--bg-primary);padding:16px;border-radius:8px;">
                        <h4>Add New Model Profile</h4>
                        <div class="form-group">
                            <label>Profile Name</label>
                            <input type="text" id="new-model-name" placeholder="e.g., gpt-4-turbo">
                        </div>
                        <div class="form-group">
                            <label>Provider</label>
                            <select id="new-model-provider">
                                <option value="upstage">Upstage Solar</option>
                                <option value="openai">OpenAI</option>
                                <option value="ollama">Ollama</option>
                                <option value="gemini">Google Gemini</option>
                                <option value="bedrock">AWS Bedrock</option>
                                <option value="azopenai">Azure OpenAI</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>Model</label>
                            <input type="text" id="new-model-model" placeholder="e.g., solar-pro2">
                        </div>
                        <div class="form-group">
                            <label>Endpoint (optional)</label>
                            <input type="text" id="new-model-endpoint" placeholder="https://api.openai.com/v1">
                        </div>
                        <div class="form-group">
                            <label>API Key (optional)</label>
                            <input type="password" id="new-model-apikey" placeholder="sk-...">
                        </div>
                        <div class="form-group">
                            <label>Description (optional)</label>
                            <input type="text" id="new-model-description" placeholder="Fast model for quick tasks">
                        </div>
                        <div style="display:flex;gap:8px;margin-top:12px;">
                            <button class="btn btn-primary" onclick="addModelProfile()">Add Profile</button>
                            <button class="btn btn-secondary" onclick="hideAddModelForm()">Cancel</button>
                        </div>
                    </div>

                    <!-- Ollama Quick Setup Section -->
                    <div class="settings-section" id="ollama-setup-section" style="margin-top:20px;padding:16px;background:linear-gradient(135deg, rgba(122,162,247,0.1), rgba(187,154,247,0.1));border-radius:12px;border:1px solid rgba(122,162,247,0.2);">
                        <div style="display:flex;align-items:center;gap:12px;margin-bottom:12px;">
                            <span style="font-size:24px;">ü¶ô</span>
                            <div>
                                <h4 style="margin:0;color:var(--accent-blue);">Ollama - Local AI (Offline Mode)</h4>
                                <p style="font-size:12px;color:var(--text-secondary);margin:4px 0 0 0;">Run AI models locally without API keys or internet</p>
                            </div>
                        </div>

                        <div id="ollama-status-panel" style="margin-bottom:12px;padding:12px;background:var(--bg-primary);border-radius:8px;">
                            <div style="display:flex;align-items:center;justify-content:space-between;">
                                <div style="display:flex;align-items:center;gap:8px;">
                                    <div id="ollama-status-dot" style="width:10px;height:10px;border-radius:50%;background:#888;"></div>
                                    <span id="ollama-status-text">Checking Ollama status...</span>
                                </div>
                                <button class="btn btn-secondary" onclick="checkOllamaStatus()" style="padding:4px 12px;font-size:12px;">Refresh</button>
                            </div>
                        </div>

                        <div id="ollama-not-installed" style="display:none;">
                            <p style="font-size:13px;margin-bottom:12px;">Ollama is not detected on your system. Install it to use AI without API keys:</p>
                            <div style="display:flex;gap:8px;flex-wrap:wrap;">
                                <button class="btn btn-primary" onclick="showOllamaInstallInstructions('macos')" style="display:flex;align-items:center;gap:6px;">
                                    <span>üçé</span> macOS
                                </button>
                                <button class="btn btn-secondary" onclick="showOllamaInstallInstructions('linux')" style="display:flex;align-items:center;gap:6px;">
                                    <span>üêß</span> Linux
                                </button>
                                <button class="btn btn-secondary" onclick="showOllamaInstallInstructions('windows')" style="display:flex;align-items:center;gap:6px;">
                                    <span>ü™ü</span> Windows
                                </button>
                            </div>
                            <div id="ollama-install-instructions" style="display:none;margin-top:12px;padding:12px;background:var(--bg-primary);border-radius:8px;font-family:var(--font-mono);font-size:12px;"></div>
                        </div>

                        <div id="ollama-installed" style="display:none;">
                            <div style="margin-bottom:12px;">
                                <label style="font-size:12px;color:var(--text-secondary);">Available Models</label>
                                <div id="ollama-models-list" style="display:flex;flex-wrap:wrap;gap:6px;margin-top:6px;">
                                    <span style="color:var(--text-secondary);font-size:12px;">Loading models...</span>
                                </div>
                            </div>

                            <div style="display:flex;gap:8px;flex-wrap:wrap;">
                                <button class="btn btn-primary" onclick="useOllamaModel()" id="use-ollama-btn" disabled>Use Selected Model</button>
                                <button class="btn btn-secondary" onclick="showOllamaPullDialog()">Pull New Model</button>
                            </div>

                            <div id="ollama-pull-dialog" style="display:none;margin-top:12px;padding:12px;background:var(--bg-primary);border-radius:8px;">
                                <label style="font-size:12px;color:var(--text-secondary);">Recommended models for Kubernetes tasks:</label>
                                <div style="display:flex;flex-wrap:wrap;gap:6px;margin:8px 0;">
                                    <button class="btn btn-secondary" onclick="pullOllamaModel('llama3.2:3b')" style="font-size:11px;padding:4px 10px;">llama3.2:3b (2GB)</button>
                                    <button class="btn btn-secondary" onclick="pullOllamaModel('qwen2.5:7b')" style="font-size:11px;padding:4px 10px;">qwen2.5:7b (4GB)</button>
                                    <button class="btn btn-secondary" onclick="pullOllamaModel('mistral:7b')" style="font-size:11px;padding:4px 10px;">mistral:7b (4GB)</button>
                                    <button class="btn btn-secondary" onclick="pullOllamaModel('codellama:7b')" style="font-size:11px;padding:4px 10px;">codellama:7b (4GB)</button>
                                </div>
                                <div style="display:flex;gap:8px;align-items:center;">
                                    <input type="text" id="ollama-custom-model" placeholder="Or enter model name..." style="flex:1;padding:8px;font-size:12px;">
                                    <button class="btn btn-primary" onclick="pullOllamaModel()" style="font-size:12px;">Pull</button>
                                </div>
                                <div id="ollama-pull-status" style="display:none;margin-top:8px;font-size:12px;"></div>
                            </div>
                        </div>
                    </div>

                    <!-- K8s Safety Guardrails Configuration -->
                    <div class="settings-section" style="margin-top:20px;">
                        <h4>üõ°Ô∏è K8s Safety Guardrails</h4>
                        <p class="settings-description" style="margin-bottom:12px;">Protect your cluster from dangerous AI-proposed operations</p>

                        <div class="settings-row">
                            <div>
                                <div class="settings-label">Enable Safety Analysis</div>
                                <div class="settings-description">Analyze K8s commands for potential risks before execution</div>
                            </div>
                            <div class="auto-refresh-toggle active" id="guardrails-toggle" onclick="toggleGuardrailsSetting()"></div>
                        </div>

                        <div class="settings-row" style="margin-top:12px;">
                            <div>
                                <div class="settings-label">Strict Mode</div>
                                <div class="settings-description">Block all dangerous/critical operations (not just warn)</div>
                            </div>
                            <div class="auto-refresh-toggle" id="guardrails-strict-toggle" onclick="toggleStrictMode()"></div>
                        </div>

                        <div class="settings-row" style="margin-top:12px;">
                            <div>
                                <div class="settings-label">Auto-Analyze AI Responses</div>
                                <div class="settings-description">Automatically analyze kubectl commands in AI responses</div>
                            </div>
                            <div class="auto-refresh-toggle active" id="guardrails-auto-analyze" onclick="toggleAutoAnalyze()"></div>
                        </div>

                        <!-- Risk Level Descriptions -->
                        <div style="margin-top:16px; padding:12px; background:var(--bg-tertiary); border-radius:8px;">
                            <div style="font-weight:600; margin-bottom:8px;">Risk Level Descriptions:</div>
                            <div style="display:grid; gap:6px; font-size:13px;">
                                <div><span style="color:var(--accent-green);">‚óè Safe</span> - Read-only operations (get, describe, logs)</div>
                                <div><span style="color:var(--accent-yellow);">‚óè Warning</span> - Modifications that need review (apply, scale)</div>
                                <div><span style="color:var(--accent-red);">‚óè Dangerous</span> - Deletions and destructive changes</div>
                                <div><span style="color:#ff4757;">‚óè Critical</span> - Cluster-wide impact (drain, delete namespace)</div>
                            </div>
                        </div>

                        <!-- Recent Safety Analysis -->
                        <div style="margin-top:16px;">
                            <div style="font-weight:600; margin-bottom:8px;">Recent Safety Checks:</div>
                            <div id="guardrails-history" style="max-height:150px; overflow-y:auto; background:var(--bg-primary); border-radius:8px; padding:8px;">
                                <div style="color:var(--text-secondary); font-size:13px;">No recent checks</div>
                            </div>
                        </div>

                        <button class="btn btn-secondary" onclick="clearGuardrailsHistory()" style="margin-top:12px;">Clear History</button>
                    </div>

                    <!-- Tool Approval Policy -->
                    <div class="settings-section" style="margin-top:20px;">
                        <h4>Tool Approval Policy</h4>
                        <p class="settings-description">Control which AI tool commands require user approval</p>
                        <div class="settings-row">
                            <div><div class="settings-label">Auto-approve read-only commands</div>
                            <div class="settings-description">kubectl get, describe, logs, etc.</div></div>
                            <div class="auto-refresh-toggle active" id="ta-auto-approve-ro" onclick="toggleToolApproval(this)"></div>
                        </div>
                        <div class="settings-row">
                            <div><div class="settings-label">Require approval for write operations</div>
                            <div class="settings-description">kubectl apply, scale, restart, etc.</div></div>
                            <div class="auto-refresh-toggle active" id="ta-require-write" onclick="toggleToolApproval(this)"></div>
                        </div>
                        <div class="settings-row">
                            <div><div class="settings-label">Block dangerous commands entirely</div>
                            <div class="settings-description">Dangerous operations will be blocked, not just requiring approval</div></div>
                            <div class="auto-refresh-toggle" id="ta-block-dangerous" onclick="toggleToolApproval(this)"></div>
                        </div>
                        <div class="settings-row">
                            <div><div class="settings-label">Require approval for unknown commands</div></div>
                            <div class="auto-refresh-toggle active" id="ta-require-unknown" onclick="toggleToolApproval(this)"></div>
                        </div>
                        <div class="form-group" style="margin-top:12px;">
                            <label>Approval Timeout (seconds)</label>
                            <input type="number" id="ta-timeout" class="form-control" value="60" min="10" max="600" style="width:120px;">
                        </div>
                        <div class="form-group">
                            <label>Blocked Patterns (one regex per line)</label>
                            <textarea id="ta-blocked-patterns" class="form-control" rows="3" placeholder="rm -rf.*&#10;kubectl delete ns.*"></textarea>
                        </div>
                        <button class="btn btn-primary" onclick="saveToolApprovalSettings()">Save Tool Approval Settings</button>
                    </div>

                    <!-- Agent Settings -->
                    <div class="settings-section" style="margin-top:20px;">
                        <h4>Agent Settings</h4>
                        <p class="settings-description">Configure AI agent behavior for tool-calling conversations</p>
                        <div class="form-group">
                            <label>Max Iterations (agent loop depth: 1-30)</label>
                            <div style="display:flex;align-items:center;gap:8px;">
                                <input type="range" id="agent-max-iterations" min="1" max="30" value="10" style="flex:1;" oninput="document.getElementById('agent-max-iter-val').textContent=this.value">
                                <span id="agent-max-iter-val" style="min-width:24px;">10</span>
                            </div>
                        </div>
                        <div class="form-group">
                            <label>Reasoning Effort</label>
                            <select id="agent-reasoning-effort" class="form-control" style="width:200px;">
                                <option value="low">Low (faster)</option>
                                <option value="medium" selected>Medium (balanced)</option>
                                <option value="high">High (deeper reasoning)</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>Temperature (0.0 = deterministic, 2.0 = creative)</label>
                            <div style="display:flex;align-items:center;gap:8px;">
                                <input type="range" id="agent-temperature" min="0" max="200" value="70" step="10" style="flex:1;" oninput="document.getElementById('agent-temp-val').textContent=(this.value/100).toFixed(1)">
                                <span id="agent-temp-val" style="min-width:32px;">0.7</span>
                            </div>
                        </div>
                        <div class="form-group">
                            <label>Max Tokens (0 = provider default)</label>
                            <input type="number" id="agent-max-tokens" class="form-control" value="4096" min="0" max="128000" step="256" style="width:150px;">
                        </div>
                        <button class="btn btn-primary" onclick="saveAgentSettings()">Save Agent Settings</button>
                    </div>
                </div>

                <!-- MCP Tab -->
                <div id="settings-mcp" class="settings-content" style="display:none;">
                    <div class="settings-section">
                        <h4>MCP Servers</h4>
                        <p class="settings-description" style="margin-bottom:12px;">Connect to Model Context Protocol servers to extend AI capabilities with additional tools.</p>

                        <div id="mcp-servers-list" style="margin-bottom:16px;">
                            <!-- Populated by JavaScript -->
                        </div>

                        <button class="btn-add" onclick="showAddMCPForm()" style="margin-top:8px;"><span class="plus-icon">+</span> Add MCP Server</button>
                    </div>

                    <div id="add-mcp-form" class="settings-section" style="display:none;margin-top:16px;background:var(--bg-primary);padding:16px;border-radius:8px;">
                        <h4>Add MCP Server</h4>
                        <div class="form-group">
                            <label>Server Name</label>
                            <input type="text" id="new-mcp-name" placeholder="e.g., kubernetes-mcp">
                        </div>
                        <div class="form-group">
                            <label>Command</label>
                            <input type="text" id="new-mcp-command" placeholder="e.g., npx, docker">
                        </div>
                        <div class="form-group">
                            <label>Arguments (comma-separated)</label>
                            <input type="text" id="new-mcp-args" placeholder="e.g., -y, @anthropic/mcp-server">
                        </div>
                        <div class="form-group">
                            <label>Description (optional)</label>
                            <input type="text" id="new-mcp-description" placeholder="Kubernetes management tools">
                        </div>
                        <div class="settings-row" style="margin-top:8px;">
                            <div>
                                <div class="settings-label">Enable on Add</div>
                            </div>
                            <input type="checkbox" id="new-mcp-enabled" checked>
                        </div>
                        <div style="display:flex;gap:8px;margin-top:12px;">
                            <button class="btn btn-primary" onclick="addMCPServer()">Add Server</button>
                            <button class="btn btn-secondary" onclick="hideAddMCPForm()">Cancel</button>
                        </div>
                    </div>

                    <div class="settings-section" style="margin-top:16px;">
                        <h4>Available Tools</h4>
                        <div id="mcp-tools-list">
                            <!-- Populated by JavaScript -->
                        </div>
                    </div>

                    <div class="settings-section" style="margin-top:16px;background:var(--bg-primary);padding:12px;border-radius:8px;">
                        <h4>Example: Kubernetes MCP Server</h4>
                        <p class="settings-description" style="font-size:12px;">
                            To add the <a href="https://github.com/containers/kubernetes-mcp-server" target="_blank" style="color:var(--accent-blue);">kubernetes-mcp-server</a>:<br><br>
                            <strong>Name:</strong> kubernetes<br>
                            <strong>Command:</strong> npx<br>
                            <strong>Args:</strong> -y, @anthropic/mcp-server-kubernetes<br>
                        </p>
                    </div>
                </div>

                <!-- Security/Trivy Settings Tab -->
                <div id="settings-security" class="settings-content" style="display:none;">
                    <div class="settings-section">
                        <h4>Trivy CVE Scanner</h4>
                        <p class="settings-description" style="margin-bottom:16px;">Trivy is used to scan container images for known vulnerabilities (CVEs). For air-gapped environments, you can download Trivy manually.</p>

                        <div id="trivy-status-card" style="padding:16px;background:var(--bg-primary);border-radius:8px;border:1px solid var(--border-color);margin-bottom:16px;">
                            <div style="display:flex;align-items:center;justify-content:space-between;">
                                <div>
                                    <div style="display:flex;align-items:center;gap:8px;margin-bottom:4px;">
                                        <span id="trivy-status-indicator" style="width:10px;height:10px;border-radius:50%;background:var(--text-secondary);"></span>
                                        <span id="trivy-status-text" style="font-weight:600;">Checking...</span>
                                    </div>
                                    <div id="trivy-version" style="font-size:12px;color:var(--text-secondary);"></div>
                                    <div id="trivy-path" style="font-size:11px;color:var(--text-muted);font-family:var(--font-mono);margin-top:4px;"></div>
                                </div>
                                <div id="trivy-actions">
                                    <button class="btn btn-primary" id="trivy-install-btn" onclick="installTrivy()" style="display:none;">Install Trivy</button>
                                    <button class="btn btn-secondary" onclick="checkTrivyStatus()">Refresh</button>
                                </div>
                            </div>
                            <div id="trivy-install-progress" style="display:none;margin-top:12px;">
                                <div style="height:6px;background:var(--bg-tertiary);border-radius:3px;overflow:hidden;">
                                    <div id="trivy-progress-bar" style="height:100%;width:0%;background:linear-gradient(90deg, var(--accent-blue), var(--accent-cyan));transition:width 0.3s;"></div>
                                </div>
                                <div id="trivy-progress-text" style="font-size:11px;color:var(--text-secondary);margin-top:4px;"></div>
                            </div>
                        </div>

                        <div id="trivy-instructions" style="display:none;padding:16px;background:var(--bg-primary);border-radius:8px;border:1px solid var(--border-color);">
                            <h5 style="margin-bottom:12px;color:var(--text-primary);">Manual Installation (Air-gapped)</h5>
                            <pre id="trivy-install-commands" style="padding:12px;background:var(--bg-tertiary);border-radius:6px;font-size:12px;overflow-x:auto;white-space:pre-wrap;"></pre>
                            <p style="margin-top:12px;font-size:12px;color:var(--text-secondary);">
                                After manual installation, click "Refresh" to detect Trivy.
                            </p>
                        </div>
                    </div>

                    <div class="settings-section" style="margin-top:20px;">
                        <h4>Security Scanning</h4>

                        <div class="settings-row">
                            <div>
                                <div class="settings-label">Enable Image Vulnerability Scanning</div>
                                <div class="settings-description">Scan container images for CVEs during security reports (requires Trivy)</div>
                            </div>
                            <input type="checkbox" id="security-scan-images" checked>
                        </div>

                        <div class="settings-row" style="margin-top:12px;">
                            <div>
                                <div class="settings-label">Minimum Severity</div>
                                <div class="settings-description">Only report vulnerabilities at or above this level</div>
                            </div>
                            <select id="security-min-severity">
                                <option value="CRITICAL">Critical only</option>
                                <option value="HIGH" selected>High and above</option>
                                <option value="MEDIUM">Medium and above</option>
                                <option value="LOW">All severities</option>
                            </select>
                        </div>
                    </div>

                </div>

                <!-- Metrics/Prometheus Settings Tab -->
                <div id="settings-metrics" class="settings-content" style="display:none;">
                    <div class="settings-section">
                        <h4>Prometheus Integration</h4>
                        <p class="settings-description" style="margin-bottom:16px;">Expose metrics for Prometheus scraping and connect to external Prometheus servers.</p>

                        <div class="settings-row">
                            <div>
                                <div class="settings-label">Expose /metrics Endpoint</div>
                                <div class="settings-description">Allow Prometheus to scrape metrics from k13d</div>
                            </div>
                            <input type="checkbox" id="prometheus-expose-metrics" onchange="updatePrometheusExposeInfo()">
                        </div>

                        <div id="prometheus-expose-info" style="margin-top:12px;padding:12px;background:var(--bg-primary);border-radius:8px;border:1px solid var(--border-color);display:none;">
                            <div style="font-size:12px;color:var(--text-secondary);">
                                Prometheus can scrape metrics at: <code style="background:var(--bg-tertiary);padding:2px 6px;border-radius:4px;font-family:var(--font-mono);">http://&lt;host&gt;:&lt;port&gt;/metrics</code>
                            </div>
                            <div style="margin-top:12px;font-size:11px;color:var(--text-secondary);">
                                <strong>Example prometheus.yml:</strong>
                                <pre style="margin-top:6px;padding:10px;background:var(--bg-tertiary);border-radius:4px;font-size:11px;overflow-x:auto;font-family:var(--font-mono);">scrape_configs:
  - job_name: 'k13d'
    static_configs:
      - targets: ['k13d:8080']</pre>
                            </div>
                        </div>
                    </div>

                    <div class="settings-section" style="margin-top:20px;">
                        <h4>External Prometheus Server</h4>
                        <p class="settings-description" style="margin-bottom:12px;">Connect to an external Prometheus server for advanced queries.</p>

                        <div class="form-group">
                            <label>Prometheus URL</label>
                            <input type="text" id="prometheus-external-url" placeholder="http://prometheus:9090">
                        </div>

                        <div class="form-group">
                            <label>Username (optional)</label>
                            <input type="text" id="prometheus-username" placeholder="admin">
                        </div>

                        <div class="form-group">
                            <label>Password (optional)</label>
                            <input type="password" id="prometheus-password" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢">
                        </div>

                        <div style="display:flex;gap:8px;margin-top:12px;">
                            <button class="btn btn-secondary" onclick="testPrometheusConnection()">Test Connection</button>
                        </div>

                        <div id="prometheus-test-result" style="margin-top:12px;padding:10px;border-radius:6px;display:none;"></div>
                    </div>

                    <div class="settings-section" style="margin-top:20px;">
                        <h4>Metrics Collection</h4>

                        <div class="settings-row">
                            <div>
                                <div class="settings-label">Enable K8s Metrics Collection</div>
                                <div class="settings-description">Collect metrics from Kubernetes metrics-server</div>
                            </div>
                            <input type="checkbox" id="prometheus-collect-k8s" checked>
                        </div>

                        <div class="settings-row" style="margin-top:12px;">
                            <div>
                                <div class="settings-label">Collection Interval</div>
                                <div class="settings-description">How often to collect metrics</div>
                            </div>
                            <select id="prometheus-collection-interval">
                                <option value="30">30 seconds</option>
                                <option value="60" selected>1 minute</option>
                                <option value="120">2 minutes</option>
                                <option value="300">5 minutes</option>
                            </select>
                        </div>
                    </div>

                    <div class="settings-section" style="margin-top:20px;">
                        <h4>Data Retention</h4>

                        <div class="settings-row">
                            <div>
                                <div class="settings-label">Metrics Retention Period</div>
                                <div class="settings-description">How long to keep historical metrics</div>
                            </div>
                            <select id="prometheus-retention-days">
                                <option value="7">7 days</option>
                                <option value="14">14 days</option>
                                <option value="30" selected>30 days</option>
                                <option value="90">90 days</option>
                            </select>
                        </div>

                        <div style="margin-top:16px;padding:12px;background:var(--bg-primary);border-radius:8px;border:1px solid var(--border-color);">
                            <div style="display:flex;justify-content:space-between;align-items:center;">
                                <div>
                                    <div style="font-weight:500;font-size:13px;">Storage Info</div>
                                    <div id="metrics-storage-info" style="font-size:12px;color:var(--text-secondary);margin-top:4px;">Calculating...</div>
                                </div>
                                <button class="btn btn-secondary" onclick="cleanupOldMetrics()" style="font-size:12px;padding:6px 12px;">Cleanup Now</button>
                            </div>
                        </div>
                    </div>

                    <div style="margin-top:20px;padding-top:16px;border-top:1px solid var(--border-color);">
                        <button class="btn btn-primary" onclick="savePrometheusSettings()">Save Prometheus Settings</button>
                    </div>
                </div>

                <div id="settings-about" class="settings-content" style="display:none;">
                    <div class="about-header">
                        <div class="about-logo">‚éà</div>
                        <div class="about-title">
                            <h2>k13d</h2>
                            <p class="about-tagline">AI-Powered Kubernetes Dashboard</p>
                        </div>
                    </div>

                    <div class="about-version-card">
                        <div class="about-version-row">
                            <span class="about-label">Version</span>
                            <span class="about-value" id="about-version">Loading...</span>
                        </div>
                        <div class="about-version-row">
                            <span class="about-label">Build Time</span>
                            <span class="about-value" id="about-build-time">-</span>
                        </div>
                        <div class="about-version-row">
                            <span class="about-label">Git Commit</span>
                            <span class="about-value about-mono" id="about-git-commit">-</span>
                        </div>
                    </div>

                    <div class="about-description">
                        <p>A modern Kubernetes dashboard combining the power of <strong>k9s-style TUI</strong> with an AI assistant. Manage clusters efficiently with natural language commands and intelligent analysis.</p>
                    </div>

                    <div class="about-features">
                        <div class="about-feature">
                            <span class="about-feature-icon">ü§ñ</span>
                            <div>
                                <strong>AI Assistant</strong>
                                <p>Natural language cluster management</p>
                            </div>
                        </div>
                        <div class="about-feature">
                            <span class="about-feature-icon">‚ö°</span>
                            <div>
                                <strong>Real-time Monitoring</strong>
                                <p>Live resource status and metrics</p>
                            </div>
                        </div>
                        <div class="about-feature">
                            <span class="about-feature-icon">üîí</span>
                            <div>
                                <strong>Safety First</strong>
                                <p>Guardrails for dangerous operations</p>
                            </div>
                        </div>
                        <div class="about-feature">
                            <span class="about-feature-icon">üåç</span>
                            <div>
                                <strong>Multi-language</strong>
                                <p>English, ÌïúÍµ≠Ïñ¥, ‰∏≠Êñá, Êó•Êú¨Ë™û</p>
                            </div>
                        </div>
                    </div>

                    <div class="about-links">
                        <a href="https://github.com/kube-ai-dashbaord/kube-ai-dashboard-cli" target="_blank" class="about-link">
                            <span>üì¶</span> GitHub Repository
                        </a>
                        <a href="https://github.com/kube-ai-dashbaord/kube-ai-dashboard-cli/issues" target="_blank" class="about-link">
                            <span>üêõ</span> Report Issue
                        </a>
                        <a href="https://github.com/kube-ai-dashbaord/kube-ai-dashboard-cli/blob/main/docs/USER_GUIDE.md" target="_blank" class="about-link">
                            <span>üìñ</span> Documentation
                        </a>
                    </div>

                    <div class="about-footer">
                        <p>Made with ‚ù§Ô∏è for the Kubernetes Community</p>
                        <p class="about-license">MIT License</p>
                    </div>
                </div>

                <!-- Notifications Tab -->
                <div id="settings-notifications" class="settings-content" style="display:none;">
                    <div class="settings-section">
                        <h4>Webhook Notifications</h4>
                        <p class="settings-description" style="margin-bottom:16px;">Receive alerts for cluster events via Slack, Discord, Teams, Email, or custom webhook.</p>
                        <div class="settings-row">
                            <div>
                                <div class="settings-label">Enable Notifications</div>
                                <div class="settings-description">Send alerts when cluster events occur</div>
                            </div>
                            <input type="checkbox" id="notif-enabled" onchange="saveNotificationSettings()">
                        </div>
                        <div class="form-group" style="margin-top:12px;">
                            <label>Platform</label>
                            <select id="notif-platform" onchange="updateNotifPlaceholder()">
                                <option value="slack">Slack</option>
                                <option value="discord">Discord</option>
                                <option value="teams">Microsoft Teams</option>
                                <option value="email">Email (SMTP)</option>
                                <option value="custom">Custom Webhook</option>
                            </select>
                        </div>
                        <div id="notif-webhook-section">
                            <div class="form-group">
                                <label>Webhook URL</label>
                                <input type="text" id="notif-webhook-url" placeholder="https://hooks.slack.com/services/...">
                            </div>
                            <div class="form-group">
                                <label>Channel (optional)</label>
                                <input type="text" id="notif-channel" placeholder="#k8s-alerts">
                            </div>
                        </div>
                        <div id="notif-smtp-section" style="display:none;">
                            <div style="display:grid;grid-template-columns:1fr 1fr;gap:8px;">
                                <div class="form-group">
                                    <label>SMTP Host</label>
                                    <input type="text" id="notif-smtp-host" placeholder="smtp.gmail.com">
                                </div>
                                <div class="form-group">
                                    <label>Port</label>
                                    <input type="number" id="notif-smtp-port" placeholder="587" value="587">
                                </div>
                            </div>
                            <div style="display:grid;grid-template-columns:1fr 1fr;gap:8px;">
                                <div class="form-group">
                                    <label>Username</label>
                                    <input type="text" id="notif-smtp-username" placeholder="user@gmail.com">
                                </div>
                                <div class="form-group">
                                    <label>Password</label>
                                    <input type="password" id="notif-smtp-password" placeholder="app password">
                                </div>
                            </div>
                            <div class="form-group">
                                <label>From Address</label>
                                <input type="text" id="notif-smtp-from" placeholder="alerts@example.com">
                            </div>
                            <div class="form-group">
                                <label>To Addresses (comma-separated)</label>
                                <input type="text" id="notif-smtp-to" placeholder="admin@example.com, team@example.com">
                            </div>
                            <div class="settings-row">
                                <div><div class="settings-label">Use TLS</div></div>
                                <input type="checkbox" id="notif-smtp-tls" checked>
                            </div>
                        </div>
                    </div>
                    <div class="settings-section" style="margin-top:16px;">
                        <h4>Event Triggers</h4>
                        <div class="settings-row"><div><div class="settings-label">Pod CrashLoopBackOff</div></div><input type="checkbox" id="notif-evt-crash" checked></div>
                        <div class="settings-row"><div><div class="settings-label">Pod OOMKilled</div></div><input type="checkbox" id="notif-evt-oom" checked></div>
                        <div class="settings-row"><div><div class="settings-label">Node Not Ready</div></div><input type="checkbox" id="notif-evt-node" checked></div>
                        <div class="settings-row"><div><div class="settings-label">Deployment Failed</div></div><input type="checkbox" id="notif-evt-deploy" checked></div>
                        <div class="settings-row"><div><div class="settings-label">Image Pull Failed</div></div><input type="checkbox" id="notif-evt-imagepull" checked></div>
                    </div>
                    <div style="display:flex;gap:8px;margin-top:16px;">
                        <button class="btn btn-primary" onclick="saveNotificationSettings()">Save</button>
                        <button class="btn btn-secondary" onclick="testNotification()">Send Test</button>
                    </div>
                    <div id="notif-test-result" style="margin-top:12px;padding:10px;border-radius:6px;display:none;"></div>
                    <div class="settings-section" style="margin-top:16px;">
                        <h4>Notification History</h4>
                        <div id="notif-history-body" style="max-height:300px;overflow-y:auto;">
                            <div class="loading-placeholder" style="font-size:12px;">No notifications sent yet.</div>
                        </div>
                    </div>
                </div>

                <!-- Admin Tab (visible only to admins) -->
                <div id="settings-admin" class="settings-content" style="display:none;">
                    <div class="settings-section">
                        <h4>User Management</h4>
                        <p class="settings-description" style="margin-bottom:12px;">Manage user accounts and permissions.</p>

                        <div id="admin-users-list" style="margin-bottom:16px;">
                            <!-- Populated by JavaScript -->
                        </div>

                        <button class="btn-add" onclick="showAddUserForm()" style="margin-top:8px;"><span class="plus-icon">+</span> Add User</button>
                    </div>

                    <div id="add-user-form" class="settings-section" style="display:none;margin-top:16px;background:var(--bg-primary);padding:16px;border-radius:8px;">
                        <h4>Add New User</h4>
                        <div class="form-group">
                            <label>Username</label>
                            <input type="text" id="new-user-username" placeholder="username">
                        </div>
                        <div class="form-group">
                            <label>Password</label>
                            <input type="password" id="new-user-password" placeholder="password">
                        </div>
                        <div class="form-group">
                            <label>Email (optional)</label>
                            <input type="email" id="new-user-email" placeholder="user@example.com">
                        </div>
                        <div class="form-group">
                            <label>Role</label>
                            <select id="new-user-role">
                                <option value="viewer">Viewer (read-only)</option>
                                <option value="user">User (standard)</option>
                                <option value="admin">Admin (full access)</option>
                            </select>
                        </div>
                        <div style="display:flex;gap:8px;margin-top:12px;">
                            <button class="btn btn-secondary" onclick="hideAddUserForm()">Cancel</button>
                            <button class="btn btn-primary" onclick="addUser()">Add User</button>
                        </div>
                    </div>

                    <div class="settings-section" style="margin-top:16px;">
                        <h4>Authentication Settings</h4>
                        <div class="settings-row">
                            <div>
                                <div class="settings-label">Authentication Mode</div>
                                <div class="settings-description">Select authentication method</div>
                            </div>
                            <select id="auth-mode" onchange="onAuthModeChange(this.value)">
                                <option value="local">Local (Username/Password)</option>
                                <option value="token">Kubernetes Token</option>
                                <option value="oidc">OIDC/OAuth SSO</option>
                                <option value="ldap">LDAP/Active Directory</option>
                            </select>
                        </div>
                        <div class="settings-row">
                            <div>
                                <div class="settings-label">Allow Password Login</div>
                                <div class="settings-description">Enable local password login alongside SSO</div>
                            </div>
                            <div class="auto-refresh-toggle" id="allow-password-login" onclick="toggleAllowPasswordLogin()"></div>
                        </div>
                        <div class="settings-row">
                            <div>
                                <div class="settings-label">Enable Self-Registration</div>
                                <div class="settings-description">Allow new users to create accounts</div>
                            </div>
                            <div class="auto-refresh-toggle" id="enable-signup" onclick="toggleEnableSignup()"></div>
                        </div>
                    </div>

                    <!-- OIDC/OAuth Settings -->
                    <div class="settings-section" id="oidc-settings" style="margin-top:16px;display:none;">
                        <h4>OIDC/OAuth Configuration</h4>
                        <p class="settings-description" style="margin-bottom:12px;">
                            Configure Single Sign-On with any OIDC-compliant provider (Google, Microsoft, Okta, Keycloak, etc.)
                        </p>
                        <div class="form-group">
                            <label>Provider Name</label>
                            <input type="text" id="oidc-provider-name" placeholder="e.g., Google, Okta, Keycloak">
                        </div>
                        <div class="form-group">
                            <label>Discovery URL (Well-Known)</label>
                            <input type="text" id="oidc-provider-url" placeholder="https://accounts.google.com/.well-known/openid-configuration">
                        </div>
                        <div class="form-group">
                            <label>Client ID</label>
                            <input type="text" id="oidc-client-id" placeholder="your-client-id">
                        </div>
                        <div class="form-group">
                            <label>Client Secret</label>
                            <input type="password" id="oidc-client-secret" placeholder="your-client-secret">
                        </div>
                        <div class="form-group">
                            <label>Scopes</label>
                            <input type="text" id="oidc-scopes" placeholder="openid email profile" value="openid email profile">
                        </div>
                        <div class="form-group">
                            <label>Redirect URI</label>
                            <input type="text" id="oidc-redirect-uri" placeholder="Auto-generated" readonly style="background:var(--bg-tertiary);">
                        </div>

                        <div class="settings-row" style="margin-top:12px;">
                            <div>
                                <div class="settings-label">Allow OAuth Signup</div>
                                <div class="settings-description">Create accounts for new OAuth users</div>
                            </div>
                            <div class="auto-refresh-toggle active" id="oauth-signup"></div>
                        </div>
                        <div class="settings-row">
                            <div>
                                <div class="settings-label">Merge Accounts by Email</div>
                                <div class="settings-description">Link OAuth logins to existing accounts (use with caution)</div>
                            </div>
                            <div class="auto-refresh-toggle" id="oauth-merge-email"></div>
                        </div>

                        <!-- Role Management -->
                        <h4 style="margin-top:16px;">Role Management</h4>
                        <div class="settings-row">
                            <div>
                                <div class="settings-label">Enable OAuth Role Management</div>
                                <div class="settings-description">Sync user roles from OAuth provider</div>
                            </div>
                            <div class="auto-refresh-toggle" id="oauth-role-mgmt"></div>
                        </div>
                        <div class="form-group">
                            <label>Roles Claim</label>
                            <input type="text" id="oauth-roles-claim" placeholder="roles" value="roles">
                        </div>
                        <div class="form-group">
                            <label>Admin Roles (comma-separated)</label>
                            <input type="text" id="oauth-admin-roles" placeholder="admin, k13d-admin">
                        </div>
                        <div class="form-group">
                            <label>Allowed Roles (comma-separated, empty = all)</label>
                            <input type="text" id="oauth-allowed-roles" placeholder="users, developers, admins">
                        </div>
                    </div>

                    <!-- LDAP Settings -->
                    <div class="settings-section" id="ldap-settings" style="margin-top:16px;display:none;">
                        <h4>LDAP/Active Directory Configuration</h4>
                        <p class="settings-description" style="margin-bottom:12px;">
                            Connect to your organization's LDAP or Active Directory server.
                        </p>
                        <div class="form-group">
                            <label>LDAP Server URL</label>
                            <input type="text" id="ldap-server-url" placeholder="ldap://ldap.example.com:389 or ldaps://...">
                        </div>
                        <div class="form-group">
                            <label>Bind DN</label>
                            <input type="text" id="ldap-bind-dn" placeholder="cn=admin,dc=example,dc=com">
                        </div>
                        <div class="form-group">
                            <label>Bind Password</label>
                            <input type="password" id="ldap-bind-password" placeholder="password">
                        </div>
                        <div class="form-group">
                            <label>User Search Base</label>
                            <input type="text" id="ldap-user-search-base" placeholder="ou=users,dc=example,dc=com">
                        </div>
                        <div class="form-group">
                            <label>User Search Filter</label>
                            <input type="text" id="ldap-user-search-filter" placeholder="(uid={{username}})" value="(uid={{username}})">
                        </div>
                        <div class="form-group">
                            <label>Group Search Base (optional)</label>
                            <input type="text" id="ldap-group-search-base" placeholder="ou=groups,dc=example,dc=com">
                        </div>
                        <div class="form-group">
                            <label>Group Search Filter (optional)</label>
                            <input type="text" id="ldap-group-search-filter" placeholder="(member={{userDN}})">
                        </div>
                        <div class="form-group">
                            <label>Admin Group DN (optional)</label>
                            <input type="text" id="ldap-admin-group" placeholder="cn=k13d-admins,ou=groups,dc=example,dc=com">
                        </div>
                        <div style="margin-top:12px;display:flex;gap:10px;">
                            <button class="btn btn-secondary" onclick="testLDAPConnection()">Test Connection</button>
                        </div>
                    </div>

                    <div class="settings-section" style="margin-top:16px;">
                        <h4>Authentication Status</h4>
                        <div id="auth-status" style="background:var(--bg-primary);padding:12px;border-radius:8px;">
                            <div style="display:flex;align-items:center;gap:8px;margin-bottom:8px;">
                                <span style="color:var(--status-running);">‚óè</span>
                                <span>Current Mode: <strong id="current-auth-mode">Local</strong></span>
                            </div>
                            <div style="color:var(--text-secondary);font-size:12px;">
                                Changes to authentication settings require a server restart.
                            </div>
                        </div>
                        <div style="margin-top:16px;">
                            <button class="btn btn-primary" onclick="saveAuthSettings()" style="width:100%;">
                                Save Authentication Settings
                            </button>
                        </div>
                    </div>

                    <div class="settings-section" style="margin-top:20px;">
                        <h4>Roles & Permissions</h4>
                        <p class="settings-description">Manage custom roles and feature access permissions</p>
                        <div id="roles-list-container"></div>
                        <button class="btn btn-primary" style="margin-top:12px;" onclick="showCreateRoleModal()">+ Create Custom Role</button>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeSettings()">Cancel</button>
                <button class="btn btn-primary" onclick="saveSettings()">Save</button>
            </div>
        </div>
    </div>

    <!-- Resource Detail Modal -->
    <div class="modal-overlay" id="detail-modal">
        <div class="modal detail-modal">
            <div class="modal-header">
                <h2 id="detail-title">Resource Details</h2>
                <button class="modal-close" onclick="closeDetail()">&times;</button>
            </div>
            <div class="detail-tabs">
                <button class="detail-tab active" onclick="switchDetailTab('overview')">Overview</button>
                <button class="detail-tab" onclick="switchDetailTab('yaml')">YAML</button>
                <button class="detail-tab" onclick="switchDetailTab('events')">Events</button>
                <button class="detail-tab" id="detail-pods-tab" onclick="switchDetailTab('pods')" style="display:none;">Related Pods</button>
            </div>
            <div class="detail-content" id="detail-content">
                <div id="detail-overview"></div>
                <div id="detail-yaml" style="display:none;"></div>
                <div id="detail-events" style="display:none;"></div>
                <div id="detail-pods" style="display:none;"></div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeDetail()">Close</button>
                <button class="btn btn-primary" onclick="analyzeWithAI()">ü§ñ Analyze with AI</button>
            </div>
        </div>
    </div>

    <!-- Keyboard Shortcuts Modal -->
    <div class="modal-overlay" id="shortcuts-modal">
        <div class="modal">
            <div class="modal-header">
                <h2>Keyboard Shortcuts</h2>
                <button class="modal-close" onclick="closeShortcuts()">&times;</button>
            </div>
            <div class="modal-body">
                <div class="shortcuts-grid">
                    <div class="shortcut-item" style="grid-column: 1 / -1; background: var(--bg-tertiary); border-radius: 4px; padding: 8px; margin-bottom: 8px;">
                        <span style="font-weight: 600; color: var(--accent-blue);">Navigation (TUI-style)</span>
                    </div>
                    <div class="shortcut-item">
                        <span>Command Mode</span>
                        <span class="shortcut-key">:</span>
                    </div>
                    <div class="shortcut-item">
                        <span>Filter Resources</span>
                        <span class="shortcut-key">/</span>
                    </div>
                    <div class="shortcut-item">
                        <span>Global Search</span>
                        <span class="shortcut-key">‚åòK / Ctrl+K</span>
                    </div>
                    <div class="shortcut-item">
                        <span>YAML Editor</span>
                        <span class="shortcut-key">E</span>
                    </div>
                    <div class="shortcut-item" style="grid-column: 1 / -1; background: var(--bg-tertiary); border-radius: 4px; padding: 8px; margin: 8px 0;">
                        <span style="font-weight: 600; color: var(--accent-purple);">Namespace Switching</span>
                    </div>
                    <div class="shortcut-item">
                        <span>Switch Namespace</span>
                        <span class="shortcut-key">N</span>
                    </div>
                    <div class="shortcut-item">
                        <span>Recent Namespace 1-9</span>
                        <span class="shortcut-key">Alt+1~9</span>
                    </div>
                    <div class="shortcut-item">
                        <span>All Namespaces</span>
                        <span class="shortcut-key">Alt+0</span>
                    </div>
                    <div class="shortcut-item" style="grid-column: 1 / -1; background: var(--bg-tertiary); border-radius: 4px; padding: 8px; margin: 8px 0;">
                        <span style="font-weight: 600; color: var(--accent-green);">Resource Views</span>
                    </div>
                    <div class="shortcut-item">
                        <span>View Pods</span>
                        <span class="shortcut-key">1</span>
                    </div>
                    <div class="shortcut-item">
                        <span>View Deployments</span>
                        <span class="shortcut-key">2</span>
                    </div>
                    <div class="shortcut-item">
                        <span>View Services</span>
                        <span class="shortcut-key">3</span>
                    </div>
                    <div class="shortcut-item">
                        <span>View Nodes</span>
                        <span class="shortcut-key">4</span>
                    </div>
                    <div class="shortcut-item" style="grid-column: 1 / -1; background: var(--bg-tertiary); border-radius: 4px; padding: 8px; margin: 8px 0;">
                        <span style="font-weight: 600; color: var(--accent-yellow);">Panels & Actions</span>
                    </div>
                    <div class="shortcut-item">
                        <span>Refresh Data</span>
                        <span class="shortcut-key">R</span>
                    </div>
                    <div class="shortcut-item">
                        <span>Toggle AI Panel</span>
                        <span class="shortcut-key">A</span>
                    </div>
                    <div class="shortcut-item">
                        <span>Toggle Sidebar</span>
                        <span class="shortcut-key">B</span>
                    </div>
                    <div class="shortcut-item">
                        <span>Toggle Debug Mode</span>
                        <span class="shortcut-key">D</span>
                    </div>
                    <div class="shortcut-item">
                        <span>Show Settings</span>
                        <span class="shortcut-key">S</span>
                    </div>
                    <div class="shortcut-item">
                        <span>Toggle Theme</span>
                        <span class="shortcut-key">T</span>
                    </div>
                    <div class="shortcut-item">
                        <span>Show Help</span>
                        <span class="shortcut-key">?</span>
                    </div>
                    <div class="shortcut-item">
                        <span>Close Modal</span>
                        <span class="shortcut-key">Esc</span>
                    </div>
                    <div class="shortcut-item">
                        <span>Add to AI Context</span>
                        <span class="shortcut-key">Right-click row</span>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-primary" onclick="closeShortcuts()">Got it!</button>
            </div>
        </div>
    </div>

    <!-- Command Bar (TUI-style : command mode) -->
    <div class="command-bar-overlay" id="command-bar-overlay">
        <div class="command-bar">
            <div class="command-input-wrapper">
                <span class="command-prefix">:</span>
                <input type="text" class="command-input" id="command-input" placeholder="Type a command..." autocomplete="off">
            </div>
            <div class="command-suggestions" id="command-suggestions"></div>
            <div class="command-hint">
                <span><kbd>‚Üë‚Üì</kbd> Navigate</span>
                <span><kbd>Enter</kbd> Execute</span>
                <span><kbd>Esc</kbd> Close</span>
                <span><kbd>Tab</kbd> Autocomplete</span>
            </div>
        </div>
    </div>

    <!-- Namespace Quick Switcher -->
    <div class="namespace-indicator" id="namespace-indicator"></div>

    <!-- YAML Editor Modal -->
    <div class="yaml-editor-modal" id="yaml-editor-modal">
        <div class="yaml-editor-container">
            <div class="yaml-editor-header">
                <div class="yaml-editor-title">
                    <h3>YAML Editor</h3>
                    <span class="yaml-editor-badge" id="yaml-editor-mode">Create</span>
                </div>
                <div class="yaml-editor-actions">
                    <button class="yaml-editor-btn secondary" onclick="validateYaml()">Validate</button>
                    <button class="yaml-editor-btn secondary" onclick="formatYaml()">Format</button>
                    <button class="yaml-editor-btn primary" onclick="applyYaml()">Apply</button>
                    <button class="yaml-editor-btn secondary" onclick="closeYamlEditor()">Cancel</button>
                </div>
            </div>
            <div class="yaml-editor-body">
                <div class="yaml-editor-main">
                    <div class="yaml-editor-toolbar">
                        <label>Namespace:</label>
                        <select id="yaml-editor-namespace"></select>
                        <label style="margin-left: 16px;">Dry Run:</label>
                        <input type="checkbox" id="yaml-dry-run" checked>
                    </div>
                    <textarea class="yaml-textarea" id="yaml-editor-content" placeholder="# Paste or type your Kubernetes YAML here...
# Example:
apiVersion: v1
kind: Pod
metadata:
  name: my-pod
  namespace: default
spec:
  containers:
  - name: nginx
    image: nginx:latest"></textarea>
                </div>
                <div class="yaml-editor-sidebar">
                    <div class="yaml-editor-sidebar-header">Templates</div>
                    <div class="yaml-template-list" id="yaml-template-list"></div>
                </div>
            </div>
            <div class="yaml-editor-footer">
                <div class="yaml-editor-status" id="yaml-editor-status">
                    <span class="status-dot"></span>
                    <span class="status-text">Ready</span>
                </div>
                <div class="yaml-editor-hints">
                    <kbd>Ctrl+Enter</kbd> Apply &nbsp; <kbd>Ctrl+Shift+F</kbd> Format &nbsp; <kbd>Esc</kbd> Close
                </div>
            </div>
        </div>
    </div>

    <!-- Terminal Modal -->
    <div class="terminal-modal" id="terminal-modal">
        <div class="terminal-header">
            <div class="terminal-title">
                <span>Terminal:</span>
                <span class="pod-name" id="terminal-pod-name">-</span>
                <span class="container-name" id="terminal-container-name">-</span>
            </div>
            <button class="terminal-close" onclick="closeTerminal()">&times;</button>
        </div>
        <div class="terminal-body" id="terminal-container"></div>
    </div>

    <!-- Log Viewer Modal -->
    <div class="log-viewer-modal" id="log-viewer-modal">
        <div class="log-header">
            <div class="terminal-title">
                <span>Logs:</span>
                <span class="pod-name" id="log-pod-name">-</span>
                <span class="container-name" id="log-container-name">-</span>
            </div>
            <div class="log-controls">
                <select id="log-container-select" onchange="switchLogContainer()">
                    <option value="">Select container</option>
                </select>
                <select id="log-lines-select" onchange="reloadLogs()">
                    <option value="100">100 lines</option>
                    <option value="500">500 lines</option>
                    <option value="1000" selected>1000 lines</option>
                    <option value="5000">5000 lines</option>
                </select>
                <button id="log-follow-btn" onclick="toggleLogFollow()">Follow</button>
                <button onclick="downloadLogs()">Download</button>
                <button class="terminal-close" onclick="closeLogViewer()">&times;</button>
            </div>
        </div>
        <div class="log-pod-legend" id="log-pod-legend" style="display: none;"></div>
        <div class="log-search">
            <input type="text" id="log-search-input" placeholder="Search logs..." onkeyup="filterLogs()">
            <span class="match-count" id="log-match-count"></span>
        </div>
        <div class="log-body" id="log-content"></div>
    </div>

    <!-- Metrics Modal -->
    <div class="metrics-modal" id="metrics-modal">
        <div class="metrics-header">
            <div class="terminal-title">
                <span>Cluster Metrics Dashboard</span>
                <div class="prometheus-status" id="prometheus-status">
                    <div class="status-dot"></div>
                    <span>Metrics Source</span>
                </div>
            </div>
            <div class="log-controls">
                <div class="time-range-selector">
                    <button class="time-range-btn" data-minutes="5" onclick="setMetricsTimeRangeMinutes(5)">5m</button>
                    <button class="time-range-btn" data-minutes="15" onclick="setMetricsTimeRangeMinutes(15)">15m</button>
                    <button class="time-range-btn active" data-minutes="30" onclick="setMetricsTimeRangeMinutes(30)">30m</button>
                    <button class="time-range-btn" data-hours="1" onclick="setMetricsTimeRange(1)">1h</button>
                    <button class="time-range-btn" data-hours="6" onclick="setMetricsTimeRange(6)">6h</button>
                    <button class="time-range-btn" data-hours="24" onclick="setMetricsTimeRange(24)">24h</button>
                </div>
                <select id="metrics-namespace-select" onchange="loadMetrics()">
                    <option value="">All Namespaces</option>
                </select>
                <div class="auto-refresh-control">
                    <input type="checkbox" id="metrics-auto-refresh" checked onchange="toggleMetricsAutoRefresh()">
                    <label for="metrics-auto-refresh" style="font-size:11px;color:var(--text-secondary);cursor:pointer;">Auto</label>
                </div>
                <button onclick="collectMetricsNow()" title="Trigger immediate metrics collection" style="background:var(--accent-green);color:#1a1b26;">Collect</button>
                <button onclick="loadMetrics()">Refresh</button>
                <button class="terminal-close" onclick="closeMetrics()">&times;</button>
            </div>
        </div>
        <div class="metrics-body">
            <!-- Summary Stats Grid -->
            <div class="metrics-dashboard-grid">
                <div class="metrics-stat-card">
                    <div class="stat-icon">‚ö°</div>
                    <div class="stat-value" id="metrics-cpu-value">-</div>
                    <div class="stat-label">CPU Usage</div>
                    <div class="stat-trend" id="metrics-cpu-trend"></div>
                </div>
                <div class="metrics-stat-card">
                    <div class="stat-icon">üíæ</div>
                    <div class="stat-value" id="metrics-mem-value">-</div>
                    <div class="stat-label">Memory Usage</div>
                    <div class="stat-trend" id="metrics-mem-trend"></div>
                </div>
                <div class="metrics-stat-card">
                    <div class="stat-icon">üñ•Ô∏è</div>
                    <div class="stat-value" id="metrics-nodes-value">-/-</div>
                    <div class="stat-label">Nodes Ready</div>
                </div>
                <div class="metrics-stat-card">
                    <div class="stat-icon">üì¶</div>
                    <div class="stat-value" id="metrics-pods-value">-</div>
                    <div class="stat-label">Running Pods</div>
                    <div class="stat-trend" id="metrics-pods-trend"></div>
                </div>
            </div>

            <!-- Charts Section -->
            <div class="metrics-grid" style="grid-template-columns: 1fr 1fr; margin-bottom: 20px;">
                <div class="metric-card" style="grid-column: span 1;">
                    <h4>CPU Usage Over Time</h4>
                    <div class="metric-chart" style="height: 220px;">
                        <canvas id="cpu-chart"></canvas>
                    </div>
                </div>
                <div class="metric-card" style="grid-column: span 1;">
                    <h4>Memory Usage Over Time</h4>
                    <div class="metric-chart" style="height: 220px;">
                        <canvas id="memory-chart"></canvas>
                    </div>
                </div>
            </div>

            <!-- Node Health Section -->
            <div class="metric-card" style="margin-bottom: 20px;">
                <h4>Node Health Overview</h4>
                <div class="node-health-grid" id="node-health-grid">
                    <!-- Dynamically populated -->
                </div>
            </div>

            <!-- Top Consumers & LLM Usage -->
            <div class="metrics-grid" style="grid-template-columns: repeat(3, 1fr);">
                <div class="metric-card">
                    <h4>Top CPU Consumers</h4>
                    <div id="top-cpu-list" style="max-height: 180px; overflow-y: auto;"></div>
                </div>
                <div class="metric-card">
                    <h4>Top Memory Consumers</h4>
                    <div id="top-memory-list" style="max-height: 180px; overflow-y: auto;"></div>
                </div>
                <div class="metric-card llm-usage-widget">
                    <h4>LLM Token Usage</h4>
                    <div class="llm-stats-grid">
                        <div class="llm-stat">
                            <div class="label">Requests</div>
                            <div class="value" id="llm-total-requests">-</div>
                        </div>
                        <div class="llm-stat">
                            <div class="label">Tokens</div>
                            <div class="value tokens" id="llm-total-tokens">-</div>
                        </div>
                        <div class="llm-stat">
                            <div class="label">Prompt</div>
                            <div class="value" id="llm-prompt-tokens">-</div>
                        </div>
                        <div class="llm-stat">
                            <div class="label">Completion</div>
                            <div class="value" id="llm-completion-tokens">-</div>
                        </div>
                    </div>
                    <div class="metric-chart" style="height: 100px;">
                        <canvas id="llm-usage-chart"></canvas>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Port Forward Modal -->
    <div class="modal-overlay" id="portforward-modal">
        <div class="modal portforward-modal">
            <div class="modal-header">
                <h2>Port Forwarding</h2>
                <button class="modal-close" onclick="closePortForward()">&times;</button>
            </div>
            <div class="modal-body">
                <div class="portforward-form">
                    <div class="form-group">
                        <label>Local Port</label>
                        <input type="number" id="pf-local-port" placeholder="8080">
                    </div>
                    <div class="form-group">
                        <label>Remote Port</label>
                        <input type="number" id="pf-remote-port" placeholder="80">
                    </div>
                    <div class="form-group full-width">
                        <label>Target</label>
                        <input type="text" id="pf-target" readonly>
                    </div>
                    <div class="full-width" style="text-align: right;">
                        <button class="btn btn-primary" onclick="startPortForward()">Start Port Forward</button>
                    </div>
                </div>
                <h4 style="margin-bottom: 12px;">Active Port Forwards</h4>
                <div class="portforward-list" id="portforward-list">
                    <p style="color: var(--text-secondary); text-align: center; padding: 20px;">No active port forwards</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Audit Logs Modal -->
    <div class="modal-overlay" id="audit-modal">
        <div class="modal audit-modal">
            <div class="modal-header">
                <h2>Audit Logs</h2>
                <button class="modal-close" onclick="closeAuditModal()">&times;</button>
            </div>
            <div class="audit-filters" style="padding: 12px 24px; border-bottom: 1px solid var(--border-color); display: flex; gap: 15px; align-items: center; flex-wrap: wrap;">
                <label style="display: flex; align-items: center; gap: 5px; cursor: pointer; font-size: 13px;">
                    <input type="checkbox" id="audit-filter-llm" onchange="toggleAuditFilter('onlyLLM')">
                    <span>LLM Actions Only</span>
                </label>
                <label style="display: flex; align-items: center; gap: 5px; cursor: pointer; font-size: 13px;">
                    <input type="checkbox" id="audit-filter-errors" onchange="toggleAuditFilter('onlyErrors')">
                    <span>Errors Only</span>
                </label>
                <span style="color: var(--text-secondary); margin-left: auto; font-size: 12px;" id="audit-entry-count"></span>
                <button class="btn btn-secondary" onclick="loadAuditModalData()" style="padding: 4px 12px; font-size: 12px;">Refresh</button>
            </div>
            <div class="modal-body" style="max-height: 65vh; overflow-y: auto; padding: 0;">
                <table style="width: 100%; border-collapse: collapse; font-size: 13px;">
                    <thead id="audit-modal-header" style="position: sticky; top: 0; background: var(--bg-secondary); z-index: 1;">
                        <tr>
                            <th style="padding: 10px 12px; text-align: left;">TIME</th>
                            <th style="padding: 10px 12px; text-align: left;">USER</th>
                            <th style="padding: 10px 12px; text-align: left;">K8S USER</th>
                            <th style="padding: 10px 12px; text-align: left;">ACTION</th>
                            <th style="padding: 10px 12px; text-align: left;">RESOURCE</th>
                            <th style="padding: 10px 12px; text-align: left;">SOURCE</th>
                            <th style="padding: 10px 12px; text-align: center;">STATUS</th>
                            <th style="padding: 10px 12px; text-align: left;">DETAILS</th>
                        </tr>
                    </thead>
                    <tbody id="audit-modal-body"></tbody>
                </table>
            </div>
            <div class="modal-footer" style="padding: 12px 24px; border-top: 1px solid var(--border-color); text-align: right;">
                <button class="btn btn-secondary" onclick="closeAuditModal()">Close</button>
            </div>
        </div>
    </div>

    <!-- Reports Modal -->
    <div class="modal-overlay" id="reports-modal">
        <div class="modal reports-modal">
            <div class="modal-header">
                <h2>Generate Report</h2>
                <button class="modal-close" onclick="closeReportsModal()">&times;</button>
            </div>
            <div class="modal-body" style="max-height: 70vh; overflow-y: auto;">
                <p style="margin-bottom: 16px; color: var(--text-secondary); font-size: 13px;">
                    Select the sections to include in your report, then choose an output format.
                </p>

                <!-- Section Checkboxes -->
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-bottom: 20px;">
                    <label style="display:flex;align-items:flex-start;gap:10px;padding:12px;background:var(--bg-tertiary);border-radius:8px;cursor:pointer;border:1px solid var(--border-color);">
                        <input type="checkbox" id="report-sec-workloads" checked style="margin-top:2px;">
                        <div>
                            <div style="font-weight:600;font-size:13px;">Workloads</div>
                            <div style="font-size:11px;color:var(--text-secondary);">Pods, Deployments, Services, Images</div>
                        </div>
                    </label>
                    <label style="display:flex;align-items:flex-start;gap:10px;padding:12px;background:var(--bg-tertiary);border-radius:8px;cursor:pointer;border:1px solid var(--border-color);">
                        <input type="checkbox" id="report-sec-nodes" checked style="margin-top:2px;">
                        <div>
                            <div style="font-weight:600;font-size:13px;">Nodes & Namespaces</div>
                            <div style="font-size:11px;color:var(--text-secondary);">Node status, capacity, namespace overview</div>
                        </div>
                    </label>
                    <label style="display:flex;align-items:flex-start;gap:10px;padding:12px;background:var(--bg-tertiary);border-radius:8px;cursor:pointer;border:1px solid var(--border-color);">
                        <input type="checkbox" id="report-sec-security" style="margin-top:2px;">
                        <div>
                            <div style="font-weight:600;font-size:13px;">Security Scan</div>
                            <div style="font-size:11px;color:var(--text-secondary);">Pod security, RBAC, network policies</div>
                        </div>
                    </label>
                    <label style="display:flex;align-items:flex-start;gap:10px;padding:12px;background:var(--bg-tertiary);border-radius:8px;cursor:pointer;border:1px solid var(--border-color);">
                        <input type="checkbox" id="report-sec-trivy" style="margin-top:2px;">
                        <div>
                            <div style="font-weight:600;font-size:13px;">Trivy CVE Scan</div>
                            <div style="font-size:11px;color:var(--text-secondary);">Container image vulnerability scanning (slower)</div>
                        </div>
                    </label>
                    <label style="display:flex;align-items:flex-start;gap:10px;padding:12px;background:var(--bg-tertiary);border-radius:8px;cursor:pointer;border:1px solid var(--border-color);">
                        <input type="checkbox" id="report-sec-finops" checked style="margin-top:2px;">
                        <div>
                            <div style="font-weight:600;font-size:13px;">FinOps Analysis</div>
                            <div style="font-size:11px;color:var(--text-secondary);">Cost optimization, resource efficiency</div>
                        </div>
                    </label>
                    <label style="display:flex;align-items:flex-start;gap:10px;padding:12px;background:var(--bg-tertiary);border-radius:8px;cursor:pointer;border:1px solid var(--border-color);">
                        <input type="checkbox" id="report-sec-events" checked style="margin-top:2px;">
                        <div>
                            <div style="font-weight:600;font-size:13px;">Events</div>
                            <div style="font-size:11px;color:var(--text-secondary);">Warning events from the cluster</div>
                        </div>
                    </label>
                    <label style="display:flex;align-items:flex-start;gap:10px;padding:12px;background:var(--bg-tertiary);border-radius:8px;cursor:pointer;border:1px solid var(--border-color);">
                        <input type="checkbox" id="report-sec-metrics" style="margin-top:2px;">
                        <div>
                            <div style="font-weight:600;font-size:13px;">Metrics History</div>
                            <div style="font-size:11px;color:var(--text-secondary);">CPU/Memory usage over last 24h</div>
                        </div>
                    </label>
                    <label style="display:flex;align-items:flex-start;gap:10px;padding:12px;background:var(--bg-tertiary);border-radius:8px;cursor:pointer;border:1px solid var(--border-color);">
                        <input type="checkbox" id="report-sec-ai" style="margin-top:2px;">
                        <div>
                            <div style="font-weight:600;font-size:13px;">AI Analysis</div>
                            <div style="font-size:11px;color:var(--text-secondary);">AI-powered insights and recommendations</div>
                        </div>
                    </label>
                </div>

                <!-- Quick toggles -->
                <div style="display:flex;gap:8px;margin-bottom:20px;">
                    <button class="btn btn-secondary" onclick="reportSelectAll()" style="padding:6px 12px;font-size:12px;">Select All</button>
                    <button class="btn btn-secondary" onclick="reportSelectNone()" style="padding:6px 12px;font-size:12px;">Deselect All</button>
                </div>

                <!-- Action buttons -->
                <div style="display: flex; gap: 10px; flex-wrap: wrap;">
                    <button class="btn btn-primary" onclick="previewReport()" style="padding: 10px 20px;">Preview Report</button>
                    <button class="btn btn-secondary" onclick="downloadReport('html')" style="padding: 10px 20px;">Download HTML</button>
                    <button class="btn btn-secondary" onclick="downloadReport('csv')" style="padding: 10px 20px;">Download CSV</button>
                    <button class="btn btn-secondary" onclick="generateReport('json')" style="padding: 10px 20px;">View Summary</button>
                </div>

                <div id="report-status" style="margin-top: 20px;"></div>
                <div id="report-preview" style="margin-top: 16px;"></div>
            </div>
            <div class="modal-footer" style="padding: 12px 24px; border-top: 1px solid var(--border-color); text-align: right;">
                <button class="btn btn-secondary" onclick="closeReportsModal()">Close</button>
            </div>
        </div>
    </div>

    <!-- Resource Diff Modal -->
    <div class="modal-overlay" id="diff-modal">
        <div class="modal diff-modal">
            <div class="modal-header">
                <h2>Resource Diff</h2>
                <button class="modal-close" onclick="closeDiffModal()">&times;</button>
            </div>
            <div class="modal-body" style="padding: 0;">
                <div class="diff-toolbar" style="padding:12px 24px;border-bottom:1px solid var(--border-color);display:flex;gap:12px;align-items:center;">
                    <span style="font-size:12px;color:var(--text-secondary);">Comparing:</span>
                    <span class="diff-label" id="diff-resource-label" style="font-weight:600;"></span>
                </div>
                <div class="diff-container" id="diff-container" style="display:flex;height:60vh;overflow:hidden;">
                    <div class="diff-pane" style="flex:1;overflow:auto;border-right:1px solid var(--border-color);padding:16px;">
                        <div class="diff-pane-header" style="font-size:11px;color:var(--text-secondary);margin-bottom:8px;font-weight:600;">Last Applied</div>
                        <pre class="diff-content" id="diff-left" style="font-size:12px;white-space:pre-wrap;font-family:var(--font-mono);"></pre>
                    </div>
                    <div class="diff-pane" style="flex:1;overflow:auto;padding:16px;">
                        <div class="diff-pane-header" style="font-size:11px;color:var(--text-secondary);margin-bottom:8px;font-weight:600;">Current</div>
                        <pre class="diff-content" id="diff-right" style="font-size:12px;white-space:pre-wrap;font-family:var(--font-mono);"></pre>
                    </div>
                </div>
            </div>
            <div class="modal-footer" style="padding:12px 24px;border-top:1px solid var(--border-color);text-align:right;">
                <button class="btn btn-secondary" onclick="closeDiffModal()">Close</button>
            </div>
        </div>
    </div>

    <!-- Template Deploy Modal -->
    <div class="modal-overlay" id="template-deploy-modal">
        <div class="modal" style="max-width:700px;">
            <div class="modal-header">
                <h2>Deploy Template</h2>
                <button class="modal-close" onclick="closeTemplateDeployModal()">&times;</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label>Template</label>
                    <span id="template-deploy-name" style="font-weight:600;"></span>
                </div>
                <div class="form-group">
                    <label>Target Namespace</label>
                    <input type="text" id="template-deploy-ns" placeholder="default" value="default">
                </div>
                <div class="form-group">
                    <label>Resource Name</label>
                    <input type="text" id="template-deploy-resname" placeholder="my-app">
                </div>
                <div class="form-group">
                    <label>YAML Preview</label>
                    <textarea id="template-deploy-yaml" style="width:100%;height:300px;font-family:var(--font-mono);font-size:12px;background:var(--bg-primary);color:var(--text-primary);border:1px solid var(--border-color);border-radius:6px;padding:12px;resize:vertical;"></textarea>
                </div>
            </div>
            <div class="modal-footer" style="padding:12px 24px;border-top:1px solid var(--border-color);display:flex;justify-content:flex-end;gap:8px;">
                <button class="btn btn-secondary" onclick="closeTemplateDeployModal()">Cancel</button>
                <button class="btn btn-primary" onclick="applyTemplate()">Deploy</button>
            </div>
        </div>
    </div>

    <script src="js/core/utils.js"></script>
    <script src="js/app.js"></script>
</body>
</html>
