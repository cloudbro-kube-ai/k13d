<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>API Reference - k13d Documentation</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=IBM+Plex+Sans:wght@400;500;600;700&family=IBM+Plex+Mono:wght@400;500&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="../css/main.css">
    <link rel="stylesheet" href="../css/sidebar.css">
    <link rel="stylesheet" href="../css/content.css">
    <link rel="stylesheet" href="../css/code.css">
</head>
<body>
    <header class="top-nav">
        <div class="nav-left">
            <a href="../index.html" class="logo">
                <span class="logo-text">k13d</span>
                <span class="version-badge">v0.6.3</span>
            </a>
        </div>
        <div class="nav-center">
            <nav class="main-nav">
                <a href="../index.html" class="nav-link">Docs</a>
                <a href="api-reference.html" class="nav-link active">API</a>
                <a href="benchmarks.html" class="nav-link">Benchmarks</a>
                <a href="https://github.com/cloudbro-kube-ai/k13d" class="nav-link" target="_blank">GitHub</a>
            </nav>
        </div>
        <div class="nav-right">
            <div class="search-box">
                <input type="text" id="search-input" placeholder="Search docs..." autocomplete="off">
                <svg class="search-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <circle cx="11" cy="11" r="8"></circle>
                    <line x1="21" y1="21" x2="16.65" y2="16.65"></line>
                </svg>
            </div>
            <button class="theme-toggle" id="theme-toggle" title="Toggle theme">
                <svg class="sun-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <circle cx="12" cy="12" r="5"></circle>
                </svg>
                <svg class="moon-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
                </svg>
            </button>
        </div>
    </header>

    <div class="layout">
        <aside class="sidebar" id="sidebar">
            <nav class="sidebar-nav">
                <div class="sidebar-section">
                    <h3 class="sidebar-heading">API Reference</h3>
                    <ul class="sidebar-links">
                        <li><a href="#authentication" class="active">Authentication</a></li>
                        <li><a href="#kubernetes">Kubernetes</a></li>
                        <li><a href="#ai-chat">AI Chat</a></li>
                        <li><a href="#settings">Settings</a></li>
                        <li><a href="#admin">Admin</a></li>
                        <li><a href="#access-requests">Access Requests</a></li>
                        <li><a href="#audit">Audit</a></li>
                        <li><a href="#reports">Reports</a></li>
                    </ul>
                </div>
            </nav>
        </aside>

        <main class="main-content">
            <article class="content">
                <h1>API Reference</h1>
                <p class="lead">
                    Complete REST API documentation for the k13d Web UI.
                    All endpoints require authentication unless noted otherwise.
                </p>

                <!-- Base URL -->
                <section class="section" id="base-url">
                    <h2>Base URL</h2>
                    <pre><code>http://localhost:8080/api</code></pre>
                    <p>All endpoints are prefixed with <code>/api</code>.</p>
                </section>

                <!-- Authentication -->
                <section class="section" id="authentication">
                    <h2>Authentication</h2>

                    <div class="endpoint">
                        <div class="endpoint-header">
                            <span class="method post">POST</span>
                            <code>/api/auth/login</code>
                        </div>
                        <p>Authenticate and receive a session cookie.</p>
                        <h4>Request Body</h4>
                        <pre><code class="language-json">{
  "username": "admin",
  "password": "admin123"
}</code></pre>
                        <h4>Response</h4>
                        <pre><code class="language-json">{
  "success": true,
  "user": {
    "id": "user-123",
    "username": "admin",
    "role": "admin"
  },
  "token": "eyJhbGciOiJIUzI1NiIs..."
}</code></pre>
                    </div>

                    <div class="endpoint">
                        <div class="endpoint-header">
                            <span class="method post">POST</span>
                            <code>/api/auth/logout</code>
                        </div>
                        <p>Invalidate the current session.</p>
                    </div>

                    <div class="endpoint">
                        <div class="endpoint-header">
                            <span class="method get">GET</span>
                            <code>/api/auth/me</code>
                        </div>
                        <p>Get current user information.</p>
                        <h4>Response</h4>
                        <pre><code class="language-json">{
  "id": "user-123",
  "username": "admin",
  "role": "admin",
  "locked": false
}</code></pre>
                    </div>

                    <div class="endpoint">
                        <div class="endpoint-header">
                            <span class="method get">GET</span>
                            <code>/api/health</code>
                        </div>
                        <p>Health check endpoint (no auth required).</p>
                        <h4>Response</h4>
                        <pre><code class="language-json">{
  "status": "ok",
  "version": "0.6.3",
  "kubernetes": "connected"
}</code></pre>
                    </div>
                </section>

                <!-- Kubernetes -->
                <section class="section" id="kubernetes">
                    <h2>Kubernetes Resources</h2>

                    <div class="endpoint">
                        <div class="endpoint-header">
                            <span class="method get">GET</span>
                            <code>/api/k8s/namespaces</code>
                        </div>
                        <p>List all namespaces.</p>
                    </div>

                    <div class="endpoint">
                        <div class="endpoint-header">
                            <span class="method get">GET</span>
                            <code>/api/k8s/pods</code>
                        </div>
                        <p>List pods in namespace.</p>
                        <h4>Query Parameters</h4>
                        <table class="params-table">
                            <tr><td><code>namespace</code></td><td>Namespace to query (default: all)</td></tr>
                            <tr><td><code>labelSelector</code></td><td>Label selector filter</td></tr>
                        </table>
                    </div>

                    <div class="endpoint">
                        <div class="endpoint-header">
                            <span class="method get">GET</span>
                            <code>/api/k8s/deployments</code>
                        </div>
                        <p>List deployments.</p>
                    </div>

                    <div class="endpoint">
                        <div class="endpoint-header">
                            <span class="method get">GET</span>
                            <code>/api/k8s/services</code>
                        </div>
                        <p>List services.</p>
                    </div>

                    <div class="endpoint">
                        <div class="endpoint-header">
                            <span class="method get">GET</span>
                            <code>/api/k8s/resource/{type}/{namespace}/{name}</code>
                        </div>
                        <p>Get a specific resource's YAML manifest.</p>
                    </div>

                    <div class="endpoint">
                        <div class="endpoint-header">
                            <span class="method get">GET</span>
                            <code>/api/k8s/logs/{namespace}/{pod}</code>
                        </div>
                        <p>Stream pod logs (SSE).</p>
                        <h4>Query Parameters</h4>
                        <table class="params-table">
                            <tr><td><code>container</code></td><td>Container name (optional)</td></tr>
                            <tr><td><code>follow</code></td><td>Follow logs (default: true)</td></tr>
                            <tr><td><code>tailLines</code></td><td>Number of lines (default: 100)</td></tr>
                        </table>
                    </div>
                </section>

                <!-- AI Chat -->
                <section class="section" id="ai-chat">
                    <h2>AI Chat</h2>

                    <div class="endpoint">
                        <div class="endpoint-header">
                            <span class="method post">POST</span>
                            <code>/api/chat/stream</code>
                        </div>
                        <p>Send a message to the AI assistant. Returns Server-Sent Events (SSE).</p>
                        <h4>Request Body</h4>
                        <pre><code class="language-json">{
  "message": "Show me pods with high memory usage",
  "sessionId": "session-abc123",
  "context": {
    "namespace": "production",
    "resource": "deployment/api-server",
    "yaml": "..."
  }
}</code></pre>
                        <h4>SSE Events</h4>
                        <pre><code class="language-json"><span class="comment">// Text content</span>
{"type": "content", "text": "Let me check..."}

<span class="comment">// Tool call</span>
{"type": "tool_call", "tool": "kubectl", "args": {"command": "top pods"}}

<span class="comment">// Tool result</span>
{"type": "tool_result", "result": "NAME CPU MEM..."}

<span class="comment">// Approval request</span>
{"type": "approval_request", "id": "req-123", "command": "kubectl delete pod..."}

<span class="comment">// Complete</span>
{"type": "done"}</code></pre>
                    </div>

                    <div class="endpoint">
                        <div class="endpoint-header">
                            <span class="method post">POST</span>
                            <code>/api/chat/approve</code>
                        </div>
                        <p>Approve a pending tool execution.</p>
                        <h4>Request Body</h4>
                        <pre><code class="language-json">{
  "requestId": "req-123",
  "approved": true
}</code></pre>
                    </div>

                    <div class="endpoint">
                        <div class="endpoint-header">
                            <span class="method get">GET</span>
                            <code>/api/chat/history</code>
                        </div>
                        <p>Get chat history for a session.</p>
                        <h4>Query Parameters</h4>
                        <table class="params-table">
                            <tr><td><code>sessionId</code></td><td>Session ID</td></tr>
                            <tr><td><code>limit</code></td><td>Number of messages (default: 50)</td></tr>
                        </table>
                    </div>
                </section>

                <!-- Settings -->
                <section class="section" id="settings">
                    <h2>Settings</h2>

                    <div class="endpoint">
                        <div class="endpoint-header">
                            <span class="method get">GET</span>
                            <code>/api/settings</code>
                        </div>
                        <p>Get current settings.</p>
                    </div>

                    <div class="endpoint">
                        <div class="endpoint-header">
                            <span class="method post">POST</span>
                            <code>/api/settings</code>
                        </div>
                        <p>Update settings.</p>
                        <h4>Request Body</h4>
                        <pre><code class="language-json">{
  "llm": {
    "provider": "openai",
    "model": "gpt-4",
    "apiKey": "sk-..."
  },
  "language": "en",
  "beginnerMode": true
}</code></pre>
                    </div>
                </section>

                <!-- Admin -->
                <section class="section" id="admin">
                    <h2>Admin</h2>
                    <div class="callout callout-warning">
                        <p>These endpoints require <code>admin</code> role.</p>
                    </div>

                    <div class="endpoint">
                        <div class="endpoint-header">
                            <span class="method post">POST</span>
                            <code>/api/admin/lock</code>
                        </div>
                        <p>Lock a user account (emergency lockout).</p>
                        <h4>Request Body</h4>
                        <pre><code class="language-json">{
  "username": "user123",
  "reason": "Suspicious activity detected"
}</code></pre>
                    </div>

                    <div class="endpoint">
                        <div class="endpoint-header">
                            <span class="method post">POST</span>
                            <code>/api/admin/unlock</code>
                        </div>
                        <p>Unlock a user account.</p>
                    </div>

                    <div class="endpoint">
                        <div class="endpoint-header">
                            <span class="method get">GET</span>
                            <code>/api/admin/users</code>
                        </div>
                        <p>List all users.</p>
                    </div>
                </section>

                <!-- Access Requests -->
                <section class="section" id="access-requests">
                    <h2>Access Requests</h2>

                    <div class="endpoint">
                        <div class="endpoint-header">
                            <span class="method post">POST</span>
                            <code>/api/access/request</code>
                        </div>
                        <p>Create a new access request for elevated permissions.</p>
                        <h4>Request Body</h4>
                        <pre><code class="language-json">{
  "role": "admin",
  "reason": "Need to delete stuck pods",
  "ttl": "30m"
}</code></pre>
                    </div>

                    <div class="endpoint">
                        <div class="endpoint-header">
                            <span class="method get">GET</span>
                            <code>/api/access/requests</code>
                        </div>
                        <p>List pending access requests (admin only).</p>
                    </div>

                    <div class="endpoint">
                        <div class="endpoint-header">
                            <span class="method post">POST</span>
                            <code>/api/access/approve/{id}</code>
                        </div>
                        <p>Approve an access request (admin only, cannot self-approve).</p>
                    </div>

                    <div class="endpoint">
                        <div class="endpoint-header">
                            <span class="method post">POST</span>
                            <code>/api/access/deny/{id}</code>
                        </div>
                        <p>Deny an access request (admin only).</p>
                    </div>
                </section>

                <!-- Audit -->
                <section class="section" id="audit">
                    <h2>Audit Logs</h2>

                    <div class="endpoint">
                        <div class="endpoint-header">
                            <span class="method get">GET</span>
                            <code>/api/audit</code>
                        </div>
                        <p>Query audit logs.</p>
                        <h4>Query Parameters</h4>
                        <table class="params-table">
                            <tr><td><code>user</code></td><td>Filter by username</td></tr>
                            <tr><td><code>action</code></td><td>Filter by action type</td></tr>
                            <tr><td><code>from</code></td><td>Start time (RFC3339)</td></tr>
                            <tr><td><code>to</code></td><td>End time (RFC3339)</td></tr>
                            <tr><td><code>limit</code></td><td>Number of results</td></tr>
                        </table>
                    </div>
                </section>

                <!-- Reports -->
                <section class="section" id="reports">
                    <h2>Reports</h2>

                    <div class="endpoint">
                        <div class="endpoint-header">
                            <span class="method get">GET</span>
                            <code>/api/reports</code>
                        </div>
                        <p>Generate cluster analysis report.</p>
                        <h4>Query Parameters</h4>
                        <table class="params-table">
                            <tr><td><code>type</code></td><td>Report type: health, cost, security</td></tr>
                            <tr><td><code>format</code></td><td>Output format: json, csv, pdf</td></tr>
                            <tr><td><code>namespace</code></td><td>Scope to namespace (optional)</td></tr>
                        </table>
                    </div>
                </section>

                <nav class="content-nav">
                    <div class="nav-prev">
                        <a href="cli-reference.html">
                            <span class="nav-label">Previous</span>
                            <span class="nav-title">← CLI Reference</span>
                        </a>
                    </div>
                    <div class="nav-next">
                        <a href="environment-variables.html">
                            <span class="nav-label">Next</span>
                            <span class="nav-title">Environment Variables →</span>
                        </a>
                    </div>
                </nav>
            </article>

            <aside class="toc">
                <h4>On this page</h4>
                <ul>
                    <li><a href="#base-url">Base URL</a></li>
                    <li><a href="#authentication">Authentication</a></li>
                    <li><a href="#kubernetes">Kubernetes</a></li>
                    <li><a href="#ai-chat">AI Chat</a></li>
                    <li><a href="#settings">Settings</a></li>
                    <li><a href="#admin">Admin</a></li>
                    <li><a href="#access-requests">Access Requests</a></li>
                    <li><a href="#audit">Audit</a></li>
                    <li><a href="#reports">Reports</a></li>
                </ul>
            </aside>
        </main>
    </div>

    <div class="search-modal" id="search-modal">
        <div class="search-results" id="search-results"></div>
    </div>

    <script src="../js/main.js"></script>
    <script src="../js/search.js"></script>

    <style>
        .endpoint {
            background: var(--bg-secondary);
            border: 1px solid var(--border-color);
            border-radius: var(--radius-md);
            padding: var(--spacing-lg);
            margin-bottom: var(--spacing-lg);
        }
        .endpoint-header {
            display: flex;
            align-items: center;
            gap: var(--spacing-md);
            margin-bottom: var(--spacing-md);
        }
        .method {
            font-size: 12px;
            font-weight: 600;
            padding: 4px 8px;
            border-radius: var(--radius-sm);
            text-transform: uppercase;
        }
        .method.get { background: rgba(122, 162, 247, 0.2); color: var(--accent-blue); }
        .method.post { background: rgba(158, 206, 106, 0.2); color: var(--accent-green); }
        .method.put { background: rgba(224, 175, 104, 0.2); color: var(--accent-yellow); }
        .method.delete { background: rgba(247, 118, 142, 0.2); color: var(--accent-red); }
        .endpoint-header code {
            font-size: 14px;
            background: none;
            color: var(--text-primary);
        }
        .endpoint h4 {
            font-size: 13px;
            color: var(--text-muted);
            margin: var(--spacing-md) 0 var(--spacing-sm);
            text-transform: uppercase;
        }
        .params-table {
            width: 100%;
            font-size: 14px;
        }
        .params-table td {
            padding: var(--spacing-sm);
            border-bottom: 1px solid var(--border-light);
        }
        .params-table td:first-child {
            width: 150px;
        }
    </style>
</body>
</html>
